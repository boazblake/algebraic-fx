(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))r(o);new MutationObserver(o=>{for(const s of o)if(s.type==="childList")for(const i of s.addedNodes)i.tagName==="LINK"&&i.rel==="modulepreload"&&r(i)}).observe(document,{childList:!0,subtree:!0});function n(o){const s={};return o.integrity&&(s.integrity=o.integrity),o.referrerPolicy&&(s.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?s.credentials="include":o.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function r(o){if(o.ep)return;o.ep=!0;const s=n(o);fetch(o.href,s)}})();const J=Symbol("IOBrand"),p=e=>({[J]:!0,run:e,map:t=>p(()=>t(e())),chain:t=>p(()=>t(e()).run()),ap:t=>p(()=>t.run()(e()))});p.of=e=>p(()=>e);p.map=e=>t=>t.map(e);p.chain=e=>t=>t.chain(e);p.ap=e=>t=>t.ap(e);p.run=e=>e.run();p.sequence=e=>p(()=>e.map(t=>t.run()));p.traverse=e=>t=>p(()=>t.map(n=>e(n).run()));p.tryCatch=(e,t)=>p(()=>{try{return e()}catch(n){return t(n)}});function Q(e){const t=e.length,n=new Array(t),r=[];for(let i=0;i<t;i++){const l=e[i];if(l<0){n[i]=-1;continue}let u=0,a=r.length;for(;u<a;){const h=u+a>>1;e[r[h]]<l?u=h+1:a=h}u===r.length?r.push(i):r[u]=i,n[i]=u>0?r[u-1]:-1}let o=r.length>0?r[r.length-1]:-1;const s=[];for(;o>=0;)s.push(o),o=n[o];return s.reverse(),s}function m(e,t,n,r,o,s){return{tag:e,key:t,attrs:n,children:r||[],text:o,dom:s}}m.normalize=function(t){if(Array.isArray(t)){const n=m.normalizeChildren(t);return n.length>0?n[0]:null}return t==null||typeof t=="boolean"?null:typeof t=="object"?t:m("#",null,null,[],String(t),null)};m.normalizeChildren=function(t){const n=t.length,r=new Array(n);let o=0,s=0,i=0;for(let l=0;l<n;l++){const u=t[l];if(Array.isArray(u)){const h=m.normalizeChildren(u),y=h.length;for(let b=0;b<y;b++){const x=h[b];r[o++]=x,x.tag!=="#"&&(i++,x.key!=null&&s++)}continue}const a=m.normalize(u);a!=null&&(r[o++]=a,a.tag!=="#"&&(i++,a.key!=null&&s++))}if(i>0&&s!==0&&s!==i)throw new TypeError("All element children must either all have keys or none.");return o===r.length?r:r.slice(0,o)};const k={}.hasOwnProperty,z={},O=/(^|#|\.)([^#\.]+)/g,D=Object.create(null),W=e=>{for(const t in e)if(k.call(e,t))return!1;return!0};function X(e){let t,n="div";const r=[];let o={};for(O.lastIndex=0;t=O.exec(e);){const i=t[1],l=t[2];i===""&&l!==""?n=l:i==="#"?o.id=l:i==="."&&r.push(l)}r.length&&(o.class=r.join(" ")),W(o)&&(o=z);const s={tag:n,attrs:o};return D[e]=s,s}function Y(e,t){t.tag=e.tag;const n=t.attrs;if(n==null)return t.attrs=e.attrs,t;if(e.attrs!==z){const r={...e.attrs,...n};e.attrs.class!=null&&n.class!=null&&(r.class=e.attrs.class+" "+n.class),t.attrs=r}return t}function Z(e){return e!=null&&typeof e=="object"&&typeof e.tag=="string"&&"children"in e&&"attrs"in e}function c(e,...t){if(typeof e!="string")throw new Error("Selector must be a string");let n=null,r=0;if(t.length){const l=t[0];(l==null||typeof l=="object"&&!Array.isArray(l)&&!Z(l))&&(n=l,r=1)}const o=m.normalizeChildren(t.slice(r)),s=m("",n&&n.key,n||null,o,null,null),i=D[e]||X(e);return Y(i,s)}const tt="http://www.w3.org/2000/svg",et="http://www.w3.org/1998/Math/MathML";function H(e,t){const n=e.attrs;if(n&&n.xmlns)return n.xmlns;const r=e.tag;return r==="svg"?tt:r==="math"?et:t}const V={div:[],span:[],li:[],ul:[],p:[]};function nt(e,t){const n=V[e];if(n&&n.length>0){const r=n.pop();return r.innerHTML="",r}return t.createElement(e)}function rt(e,t){const n=e.dom;if(!n)return;n.parentNode===t&&t.removeChild(n);const r=e.tag,o=V[r];o&&o.push(n)}function E(e,t,n,r,o,s,i){for(let l=n;l<r;l++){const u=t[l];C(e,u,o,s,i)}}function C(e,t,n,r,o){if(t.tag==="#"){const s=t.dom=o.createTextNode(t.text||"");M(e,s,n)}else ot(e,t,r,n,o)}function ot(e,t,n,r,o){const s=t.tag,i=t.attrs,l=H(t,n),u=l?o.createElementNS(l,s):nt(s,o);t.dom=u,i!=null&&it(t,i),M(e,u,r);const a=t.children;a!=null&&a.length>0&&E(u,a,0,a.length,null,l,o)}function U(e,t,n,r,o,s){const i=t||[],l=n||[];if(i===l)return;const u=i.length,a=l.length;if(u===0){a>0&&E(e,l,0,a,r,o,s);return}if(a===0){N(e,i,0,u);return}const h=i[0]!=null&&i[0].key!=null,y=l[0]!=null&&l[0].key!=null;if(h!==y){N(e,i,0,u),E(e,l,0,a,r,o,s);return}if(!y){const f=u<a?u:a;for(let d=0;d<f;d++){const w=i[d],g=l[d];if(w===g)continue;const v=st(i,d+1,r);F(e,w,g,v,o,s)}u>f&&N(e,i,f,u),a>f&&E(e,l,f,a,r,o,s);return}const b=new Map;for(let f=0;f<u;f++){const d=i[f];d!=null&&d.key!=null&&b.set(d.key,f)}const x=new Set,S=new Int32Array(a);S.fill(-1);for(let f=0;f<a;f++){const d=l[f],w=d!=null?d.key:null,g=w!=null?b.get(w)??-1:-1;if(S[f]=g,g>=0){const v=i[g];x.add(g),v!==d&&F(e,v,d,null,o,s)}}for(let f=0;f<u;f++)x.has(f)||R(e,i[f]);const _=Q(Array.from(S)),G=new Set(_);let I=r;for(let f=a-1;f>=0;f--){const d=l[f];if(!d)continue;const w=S[f];let g=d.dom;w<0?(C(e,d,I,o,s),g=d.dom):!G.has(f)&&g&&g.nextSibling!==I&&M(e,g,I),I=g}}function F(e,t,n,r,o,s){if(t!==n){if(t.tag==="#"&&n.tag==="#"){n.dom=t.dom;const i=t.dom;i&&t.text!==n.text&&(i.nodeValue=n.text??"");return}if(t.tag===n.tag){const i=t.dom;n.dom=i;const l=t.children,u=n.children;if(l.length===0&&u.length===0&&n.text!=null&&t.tag!=="#"){const h=i,y=h&&h.firstChild;(y&&y.nodeValue||"")!==n.text&&(h.textContent=n.text);return}const a=H(n,o);t.attrs!==n.attrs&&ct(n,t.attrs,n.attrs),U(i,l,u,null,a,s);return}R(e,t),C(e,n,r,o,s)}}function M(e,t,n){n?e.insertBefore(t,n):e.appendChild(t)}function N(e,t,n,r){for(let o=n;o<r;o++){const s=t[o];R(e,s)}}function R(e,t){rt(t,e)}function st(e,t,n){const r=e.length;for(;t<r;t++){const o=e[t];if(o&&o.dom)return o.dom}return n}function it(e,t,n){for(const r in t)k.call(t,r)&&j(e,r,null,t[r])}function j(e,t,n,r,o){if(t==="key")return;const s=e.dom;if(t.slice(0,2)==="on"){s[t]=typeof r=="function"?r:null;return}if(r==null){q(e,t,n);return}if(t==="value"){s.value!==r&&(s.value=r);return}if(t==="checked"){const i=!!r;s.checked!==i&&(s.checked=i);return}if(t==="selected"){const i=!!r;s.selected!==i&&(s.selected=i);return}if(t==="style"){B(s,n,r);return}if(t==="class"){s.className=r;return}if(typeof r=="boolean"){r?s.setAttribute(t,""):s.removeAttribute(t);return}s.setAttribute(t,String(r))}function q(e,t,n,r){const o=e.dom;if(t.slice(0,2)==="on"){o[t]=null;return}if(t==="style"){B(o,n,null);return}if(t==="class"){o.removeAttribute("class");return}o.removeAttribute(t)}function ct(e,t,n,r){if(t)for(const o in t){const s=t[o];s!=null&&(!n||n[o]==null)&&q(e,o,s)}if(n)for(const o in n){const s=n[o],i=t&&t[o];s!==i&&j(e,o,i,s)}}function B(e,t,n){if(n==null){e.removeAttribute("style");return}if(typeof n=="string"){e.setAttribute("style",n);return}e.removeAttribute("style");for(const r in n){const o=n[r];o!=null&&(r.indexOf("-")!==-1?e.style.setProperty(r,String(o)):e.style[r]=String(o))}}function lt(e,t){if(!e)throw new TypeError("Root DOM is null");const n=e.namespaceURI,r=e.vnodes;r==null&&(e.textContent="");const o=m.normalizeChildren(Array.isArray(t)?t:[t]),s=e.ownerDocument;U(e,r,o,null,n==="http://www.w3.org/1999/xhtml"?void 0:n??void 0,s),e.vnodes=o}const ut=Symbol("IOEffect"),at=Symbol("ReaderEffect"),L=(e,t,n)=>{if(n==null||typeof n!="function")throw new TypeError("runEffects: dispatch must be a function");!e||e.length===0||e.forEach(r=>{if(r)try{if(r._tag===ut){r.io.run();return}if(r._tag===at){r.reader.run(t).run();return}const o=r;if(o.run&&typeof o.run=="function"){const s=o.run(t,n);s&&typeof s.catch=="function"&&s.catch(i=>{console.error("Effect execution error:",i)})}}catch(o){console.error("Effect execution error:",o)}})},ft=(e,t,n,r)=>{if(!e)throw new TypeError("renderApp: root element is required");if(!t)throw new TypeError("renderApp: program is required");if(!t.init||typeof t.init.run!="function")throw new TypeError("renderApp: program.init must be an IO");if(!t.update||typeof t.update!="function")throw new TypeError("renderApp: program.update must be a function");if(!t.view||typeof t.view!="function")throw new TypeError("renderApp: program.view must be a function");if(!r||typeof r!="function")throw new TypeError("renderApp: renderer must be a function");let o;const s=u=>{try{const{model:a,effects:h}=t.update(u,o,s);o=a;const y=t.view(o,s);r(e,y),L(h,n,s)}catch(a){throw console.error("Update/render cycle error:",a),a}},i=t.init.run();o=i.model;const l=t.view(o,s);r(e,l),L(i.effects,n,s)},dt={document,window},pt=(e,t)=>{lt(e,t)},ht=p.of({inputSymbol:"",inputShares:"",nextId:1,items:[]}),yt=e=>{let t=0;const n=e.toUpperCase();for(let o=0;o<n.length;o+=1)t=t*31+n.charCodeAt(o)|0;return 50+Math.abs(t%150)},gt=e=>{const t=Number(e);return!Number.isFinite(t)||t<=0?null:t},P=(e,t)=>{switch(e.type){case"InputSymbol":return{model:{...t,inputSymbol:e.value.toUpperCase()},effects:[]};case"InputShares":return{model:{...t,inputShares:e.value},effects:[]};case"Add":{const n=t.inputSymbol.trim().toUpperCase(),r=gt(t.inputShares);if(!n||r==null)return{model:t,effects:[]};const o=t.nextId,s=yt(n),i={id:o,symbol:n,shares:r,price:s,error:null,isLoading:!1};return{model:{...t,inputSymbol:"",inputShares:"",nextId:o+1,items:[...t.items,i]},effects:[]}}case"Remove":return{model:{...t,items:t.items.filter(n=>n.id!==e.id)},effects:[]};case"PriceLoaded":return{model:t,effects:[]};case"PriceFailed":return{model:t,effects:[]}}},mt=(e,t)=>c("tr",[c("td",e.symbol),c("td.text-right",e.shares.toString()),c("td.text-right",e.price==null?"-":`$${e.price.toFixed(2)}`),c("td.text-right",e.price==null?"-":`$${(e.price*e.shares).toFixed(2)}`),c("td.text-right",e.error?c("span.text-sm.text-red-500",e.error):e.isLoading?c("span.text-sm.text-amber-500","Loadingâ€¦"):""),c("td.text-right",c("button",{type:"button",onclick:()=>t({type:"Remove",id:e.id})},"Remove"))]),bt=(e,t)=>{const n=s=>{const i=s.target.value;t({type:"InputSymbol",value:i})},r=s=>{const i=s.target.value;t({type:"InputShares",value:i})},o=e.items.reduce((s,i)=>i.price==null?s:s+i.price*i.shares,0);return c("section",[c("h2","Holdings"),c("form",{onsubmit:s=>s.preventDefault()},[c("label",["Symbol",c("input",{value:e.inputSymbol,oninput:n})]),c("label",["Shares",c("input",{value:e.inputShares,oninput:r})]),c("button",{type:"button",onclick:()=>t({type:"Add"})},"Add")]),c("table",[c("thead",[c("tr",[c("th","Symbol"),c("th.text-right","Shares"),c("th.text-right","Price"),c("th.text-right","Value"),c("th.text-right","Status"),c("th")])]),c("tbody",e.items.length===0?c("tr",[c("td",{colspan:6},"No holdings yet. Add a position to get started.")]):e.items.map(s=>mt(s,t)))]),c("p",`Total value: $${o.toFixed(2)}`)])},wt=p.of({items:[],inputSymbol:"",inputPercent:""}),xt=e=>{const t=Number(e);return!Number.isFinite(t)||t<=0||t>100?null:t},$=(e,t)=>{switch(e.type){case"InputSymbol":return{model:{...t,inputSymbol:e.value.toUpperCase()},effects:[]};case"InputPercent":return{model:{...t,inputPercent:e.value},effects:[]};case"Add":{const n=t.inputSymbol.trim().toUpperCase(),r=xt(t.inputPercent);if(!n||r==null)return{model:t,effects:[]};if(t.items.some(i=>i.symbol===n))return{model:t,effects:[]};const s={symbol:n,targetPercent:r};return{model:{...t,inputSymbol:"",inputPercent:"",items:[...t.items,s]},effects:[]}}case"Remove":return{model:{...t,items:t.items.filter(n=>n.symbol!==e.symbol)},effects:[]}}},At=(e,t)=>c("tr",[c("td",e.symbol),c("td.text-right",`${e.targetPercent.toFixed(1)}%`),c("td.text-right",c("button",{type:"button",onclick:()=>t({type:"Remove",symbol:e.symbol})},"Remove"))]),St=(e,t)=>{const n=s=>{const i=s.target.value;t({type:"InputSymbol",value:i})},r=s=>{const i=s.target.value;t({type:"InputPercent",value:i})},o=e.items.reduce((s,i)=>s+i.targetPercent,0);return c("section",[c("h2","Targets"),c("form",{onsubmit:s=>s.preventDefault()},[c("label",["Symbol",c("input",{value:e.inputSymbol,oninput:n})]),c("label",["Target %",c("input",{value:e.inputPercent,oninput:r})]),c("button",{type:"button",onclick:()=>t({type:"Add"})},"Add")]),c("table",[c("thead",[c("tr",[c("th","Symbol"),c("th.text-right","Target %"),c("th")])]),c("tbody",e.items.length===0?c("tr",[c("td",{colspan:3},"No targets yet. Add desired allocations.")]):e.items.map(s=>At(s,t)))]),c("p",`Total target: ${o.toFixed(1)}%`)])},It=p.of({nextId:1,entries:[]}),A=(e,t)=>{switch(e.type){case"Append":{const n={...e.entry,id:t.nextId};return{model:{nextId:t.nextId+1,entries:[n,...t.entries]},effects:[]}}case"Clear":return{model:{...t,entries:[]},effects:[]}}},vt=e=>{switch(e){case"AddHolding":return"Added holding";case"RemoveHolding":return"Removed holding";case"InvalidHoldingInput":return"Invalid holding input";case"AddTarget":return"Added target";case"RemoveTarget":return"Removed target"}},Pt=e=>{const t=new Date(e.ts).toLocaleTimeString(),n=vt(e.kind),r=JSON.stringify(e.data);return`[${t}] ${n}: ${r}`},Tt=(e,t)=>c("section",[c("div",[c("h2","Audit"),c("button",{type:"button",onclick:()=>t({type:"Clear"})},"Clear")]),c("ul",e.entries.length===0?c("li","No audit entries yet."):e.entries.map(n=>c("li",{key:n.id},Pt(n))))]),Et=(e,t)=>{const n=e.reduce((o,s)=>s.price==null?o:o+s.price*s.shares,0),r=t.map(o=>{const s=e.find(a=>a.symbol===o.symbol),i=s&&s.price!=null?s.price*s.shares:0,l=n>0?i/n*100:0,u=l-o.targetPercent;return{symbol:o.symbol,target:o.targetPercent,current:l,delta:u}});return c("section",[c("h2","Summary"),c("p",`Total portfolio value: $${n.toFixed(2)}`),c("table",[c("thead",[c("tr",[c("th","Symbol"),c("th.text-right","Target %"),c("th.text-right","Current %"),c("th.text-right","Delta %")])]),c("tbody",r.length===0?c("tr",[c("td",{colspan:4},"No targets defined yet.")]):r.map(o=>c("tr",{key:o.symbol},[c("td",o.symbol),c("td.text-right",`${o.target.toFixed(1)}%`),c("td.text-right",`${o.current.toFixed(1)}%`),c("td.text-right",`${o.delta.toFixed(1)}%`)])))])])},T=(e,t,n)=>({id:n,ts:Date.now(),kind:e,data:t}),Nt=p.of(()=>{const e=ht.run(),t=wt.run(),n=It.run();return{model:{holdings:e,targets:t,audit:n},effects:[]}}).map(e=>e()),$t=(e,t,n)=>{switch(e.type){case"Holdings":{const{msg:r}=e;if(r.type==="Add"){const{inputSymbol:i,inputShares:l}=t.holdings,u=T("AddHolding",{symbol:i,shares:l},t.audit.nextId),{model:a}=A({type:"Append",entry:u},t.audit),{model:h,effects:y}=P(r,t.holdings);return{model:{...t,holdings:h,audit:a},effects:y}}if(r.type==="Remove"){const i=T("RemoveHolding",{id:r.id},t.audit.nextId),{model:l}=A({type:"Append",entry:i},t.audit),{model:u,effects:a}=P(r,t.holdings);return{model:{...t,holdings:u,audit:l},effects:a}}if(r.type==="InputSymbol"||r.type==="InputShares"){const{model:i,effects:l}=P(r,t.holdings);return{model:{...t,holdings:i},effects:l}}const{model:o,effects:s}=P(r,t.holdings);return{model:{...t,holdings:o},effects:s}}case"Targets":{const{msg:r}=e;if(r.type==="Add"){const{inputSymbol:i,inputPercent:l}=t.targets,u=T("AddTarget",{symbol:i,targetPercent:l},t.audit.nextId),{model:a}=A({type:"Append",entry:u},t.audit),{model:h,effects:y}=$(r,t.targets);return{model:{...t,targets:h,audit:a},effects:y}}if(r.type==="Remove"){const i=T("RemoveTarget",{symbol:r.symbol},t.audit.nextId),{model:l}=A({type:"Append",entry:i},t.audit),{model:u,effects:a}=$(r,t.targets);return{model:{...t,targets:u,audit:l},effects:a}}const{model:o,effects:s}=$(r,t.targets);return{model:{...t,targets:o},effects:s}}case"Audit":{const{model:r,effects:o}=A(e.msg,t.audit);return{model:{...t,audit:r},effects:o}}}},Ct=(e,t)=>c("div",[c("h1","FP Rebalance (algebraic-fx)"),c("main",[c("div",[bt(e.holdings,n=>t({type:"Holdings",msg:n})),St(e.targets,n=>t({type:"Targets",msg:n}))]),Et(e.holdings.items,e.targets.items),Tt(e.audit,n=>t({type:"Audit",msg:n}))])]),Mt={init:Nt,update:$t,view:Ct},K=document.getElementById("app");if(!K)throw new Error("#app not found");ft(K,Mt,dt,pt);
