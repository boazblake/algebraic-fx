(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))s(n);new MutationObserver(n=>{for(const o of n)if(o.type==="childList")for(const c of o.addedNodes)c.tagName==="LINK"&&c.rel==="modulepreload"&&s(c)}).observe(document,{childList:!0,subtree:!0});function r(n){const o={};return n.integrity&&(o.integrity=n.integrity),n.referrerPolicy&&(o.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?o.credentials="include":n.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function s(n){if(n.ep)return;n.ep=!0;const o=r(n);fetch(n.href,o)}})();const Rt=Symbol("IOBrand"),d=t=>({[Rt]:!0,run:t,map:e=>d(()=>e(t())),chain:e=>d(()=>e(t()).run()),ap:e=>d(()=>e.run()(t()))});d.of=t=>d(()=>t);d.map=t=>e=>e.map(t);d.chain=t=>e=>e.chain(t);d.ap=t=>e=>e.ap(t);d.run=t=>t.run();d.sequence=t=>d(()=>t.map(e=>e.run()));d.traverse=t=>e=>d(()=>e.map(r=>t(r).run()));d.tryCatch=(t,e)=>d(()=>{try{return t()}catch(r){return e(r)}});const ut=Symbol("EitherBrand"),T=t=>({_tag:"Left",left:t,[ut]:!0}),w=t=>({_tag:"Right",right:t,[ut]:!0}),Pt=(t,e)=>e._tag==="Right"?w(t(e.right)):e,Lt=(t,e)=>t._tag==="Left"?T(t.left):e._tag==="Left"?T(e.left):w(t.right(e.right)),Nt=(t,e)=>e._tag==="Right"?t(e.right):e,Ot=(t,e,r)=>r._tag==="Left"?T(t(r.left)):w(e(r.right)),Ct=(t,e)=>e._tag==="Left"?T(t(e.left)):e,$t=(t,e,r)=>r._tag==="Left"?t(r.left):e(r.right),Dt=t=>w(t),It=(t,e)=>e._tag==="Right"?e.right:t,Ht=(t,e)=>e._tag==="Right"?e.right:t(e.left),Mt=(t,e)=>t._tag==="Right"?t:e,Ft=t=>t._tag==="Left",xt=t=>t._tag==="Right",Vt=t=>e=>e==null?T(t):w(e),Bt=t=>{try{return w(t())}catch(e){return T(e)}},Jt=(t,e)=>{try{return w(t())}catch(r){return T(e(r))}},Ut=t=>t._tag==="Left"?w(t.left):T(t.right),Gt=(t,e,r)=>r._tag==="Right"&&!t(r.right)?T(e(r.right)):r,ft=(t,e)=>{const r=[];for(const s of e){const n=t(s);if(n._tag==="Left")return n;r.push(n.right)}return w(r)},qt=t=>ft(e=>e,t),L={Left:T,Right:w,map:Pt,ap:Lt,chain:Nt,bimap:Ot,mapLeft:Ct,fold:$t,of:Dt,getOrElse:It,getOrElseW:Ht,alt:Mt,isLeft:Ft,isRight:xt,fromNullable:Vt,tryCatch:Bt,tryCatchK:Jt,swap:Ut,filterOrElse:Gt,traverse:ft,sequence:qt},dt=Symbol("MaybeBrand"),V=t=>({_tag:"Just",value:t,[dt]:!0}),H={_tag:"Nothing",[dt]:!0},jt=(t,e)=>e._tag==="Just"?V(t(e.value)):H,Kt=(t,e)=>t._tag==="Just"&&e._tag==="Just"?V(t.value(e.value)):H,Wt=(t,e)=>e._tag==="Just"?t(e.value):H,zt=t=>V(t),Yt=(t,e,r)=>r._tag==="Nothing"?t():e(r.value),Qt=(t,e)=>e._tag==="Just"?e.value:t,Xt=(t,e)=>e._tag==="Just"?e.value:t(),Zt=(t,e)=>t._tag==="Just"?t:e,te=t=>t==null?H:V(t),ee=t=>t._tag==="Just"?t.value:null,re=t=>t._tag==="Just"?t.value:void 0,se=t=>t._tag==="Just",ne=t=>t._tag==="Nothing",oe=(t,e)=>e._tag==="Just"&&t(e.value)?e:H,ht=(t,e)=>{const r=[];for(const s of e){const n=t(s);if(n._tag==="Nothing")return H;r.push(n.value)}return V(r)},ce=t=>ht(e=>e,t),k={Just:V,Nothing:H,map:jt,ap:Kt,chain:Wt,of:zt,fold:Yt,getOrElse:Qt,getOrElseW:Xt,alt:Zt,fromNullable:te,toNullable:ee,toUndefined:re,isJust:se,isNothing:ne,filter:oe,traverse:ht,sequence:ce},ie=Symbol("ReaderBrand"),E=t=>({[ie]:!0,run:t,map:e=>E(r=>e(t(r))),chain:e=>E(r=>e(t(r)).run(r)),ap:e=>E(r=>e.run(r)(t(r)))});E.of=t=>E(()=>t);E.ask=()=>E(t=>t);E.asks=t=>E(t);E.map=t=>e=>e.map(t);E.chain=t=>e=>e.chain(t);E.ap=t=>e=>e.ap(t);E.run=t=>e=>e.run(t);E.local=t=>e=>E(r=>e.run(t(r)));E.sequence=t=>E(e=>t.map(r=>r.run(e)));E.traverse=t=>e=>E(r=>e.map(s=>t(s).run(r)));const ae=Symbol("StateBrand"),b=t=>({[ae]:!0,run:t,map:e=>b(r=>{const[s,n]=t(r);return[e(s),n]}),chain:e=>b(r=>{const[s,n]=t(r);return e(s).run(n)}),ap:e=>b(r=>{const[s,n]=e.run(r),[o,c]=t(n);return[s(o),c]})});b.of=t=>b(e=>[t,e]);b.get=()=>b(t=>[t,t]);b.put=t=>b(()=>[void 0,t]);b.modify=t=>b(e=>[void 0,t(e)]);b.gets=t=>b(e=>[t(e),e]);b.map=t=>e=>e.map(t);b.chain=t=>e=>e.chain(t);b.ap=t=>e=>e.ap(t);b.run=t=>e=>e.run(t);b.evalState=t=>e=>e.run(t)[0];b.execState=t=>e=>e.run(t)[1];b.sequence=t=>b(e=>{let r=e;const s=[];for(const n of t){const[o,c]=n.run(r);s.push(o),r=c}return[s,r]});b.traverse=t=>e=>b.sequence(e.map(t));const le=Symbol("TaskBrand"),p=t=>({[le]:!0,run:()=>t(),runWith:e=>{if(!e)throw new Error("Task.runWith requires an AbortSignal. Use run() if cancellation is not needed.");return t(e)},map:e=>p(r=>t(r).then(s=>s._tag==="Right"?w(e(s.right)):s)),chain:e=>p(r=>t(r).then(s=>s._tag==="Right"?e(s.right).runWith(r):Promise.resolve(s))),ap:e=>p(r=>e.runWith(r).then(s=>s._tag==="Right"?t(r).then(n=>n._tag==="Right"?w(s.right(n.right)):n):Promise.resolve(s))),mapError:e=>p(r=>t(r).then(s=>s._tag==="Left"?T(e(s.left)):s)),bimap:(e,r)=>p(s=>t(s).then(n=>n._tag==="Left"?T(e(n.left)):w(r(n.right))))});p.of=t=>p(()=>Promise.resolve(w(t)));p.reject=t=>p(()=>Promise.resolve(T(t)));p.tryCatch=t=>p(()=>t().then(w).catch(T));p.tryCatchK=(t,e)=>p(()=>t().then(w).catch(r=>T(e(r))));p.map=t=>e=>e.map(t);p.chain=t=>e=>e.chain(t);p.ap=t=>e=>e.ap(t);p.mapError=t=>e=>e.mapError(t);p.bimap=(t,e)=>r=>r.bimap(t,e);p.fold=(t,e)=>r=>r.run().then(s=>s._tag==="Left"?t(s.left):e(s.right));p.getOrElse=t=>e=>e.run().then(r=>r._tag==="Right"?r.right:t);p.delay=t=>e=>p(r=>new Promise(s=>{const n=setTimeout(()=>{e.runWith(r).then(s)},t);r&&r.addEventListener("abort",()=>{clearTimeout(n),s(T({message:"Task.delay aborted"}))},{once:!0})}));p.timeout=(t,e)=>r=>p(s=>new Promise(n=>{const o=setTimeout(()=>n(T(e)),t),c=r.runWith(s).then(a=>{clearTimeout(o),n(a)});return s&&s.addEventListener("abort",()=>{clearTimeout(o)}),c}));p.sequence=t=>p(e=>(async()=>{const r=[];for(const s of t){const n=await s.runWith(e);if(n._tag==="Left")return n;r.push(n.right)}return w(r)})());p.traverse=t=>e=>p.sequence(e.map(t));p.all=t=>p(e=>Promise.all(t.map(r=>r.runWith(e))).then(r=>{const s=[];for(const n of r){if(n._tag==="Left")return n;s.push(n.right)}return w(s)}));p.race=t=>p(e=>Promise.race(t.map(r=>r.runWith(e))));p.fromEither=t=>p(()=>Promise.resolve(t));p.toPromise=t=>t.run().then(e=>{if(e._tag==="Left")throw e.left;return e.right});const gt=Symbol("ValidationBrand"),$=t=>({_tag:"Failure",errors:t,[gt]:!0}),D=t=>({_tag:"Success",value:t,[gt]:!0}),ue=(t,e)=>e._tag==="Success"?D(t(e.value)):e,fe=(t,e)=>t._tag==="Failure"&&e._tag==="Failure"?$([...t.errors,...e.errors]):t._tag==="Failure"?t:e._tag==="Failure"?e:D(t.value(e.value)),de=(t,e)=>e._tag==="Success"?t(e.value):e,he=(t,e,r)=>r._tag==="Failure"?$(t(r.errors)):D(e(r.value)),ge=(t,e)=>e._tag==="Failure"?$(t(e.errors)):e,pe=t=>D(t),me=(t,e,r)=>r._tag==="Failure"?t(r.errors):e(r.value),ye=(t,e)=>e._tag==="Success"?e.value:t,Ee=(t,e)=>e._tag==="Success"?e.value:t(e.errors),be=t=>t._tag==="Failure",Se=t=>t._tag==="Success",pt=t=>$([t]),ke=(t,e)=>t._tag==="Success"?t:e._tag==="Success"?e:$([...t.errors,...e.errors]),_e=t=>{const e=[],r=[];for(const s of t)s._tag==="Success"?e.push(s.value):r.push(...s.errors);return r.length>0?$(r):D(e)},mt=(t,e)=>{const r=[],s=[];for(const n of e){const o=t(n);o._tag==="Success"?r.push(o.value):s.push(...o.errors)}return s.length>0?$(s):D(r)},we=t=>mt(e=>e,t),ve=(t,e)=>r=>t(r)?D(r):pt(e(r)),I={Failure:$,Success:D,map:ue,ap:fe,chain:de,bimap:he,mapErrors:ge,of:pe,fold:me,getOrElse:ye,getOrElseW:Ee,isFailure:be,isSuccess:Se,fail:pt,alt:ke,combine:_e,traverse:mt,sequence:we,fromPredicate:ve};function Te(t){const e=t.length,r=new Array(e),s=[];for(let c=0;c<e;c++){const a=t[c];if(a<0){r[c]=-1;continue}let l=0,m=s.length;for(;l<m;){const S=l+m>>1;t[s[S]]<a?l=S+1:m=S}l===s.length?s.push(c):s[l]=c,r[c]=l>0?s[l-1]:-1}let n=s.length>0?s[s.length-1]:-1;const o=[];for(;n>=0;)o.push(n),n=r[n];return o.reverse(),o}function C(t,e,r,s,n,o){return{tag:t,key:e,attrs:r,children:s||[],text:n,dom:o}}C.normalize=function(t){if(Array.isArray(t)){const e=C.normalizeChildren(t);return e.length>0?e[0]:null}return t==null||typeof t=="boolean"?null:typeof t=="object"?t:C("#",null,null,[],String(t),null)};C.normalizeChildren=function(t){const e=[];let r=0,s=0;for(let n=0;n<t.length;n++){const o=t[n];if(Array.isArray(o)){const a=C.normalizeChildren(o);for(let l=0;l<a.length;l++){const m=a[l];e.push(m),m.tag!=="#"&&(s++,m.key!=null&&r++)}continue}const c=C.normalize(o);c!=null&&(e.push(c),c.tag!=="#"&&(s++,c.key!=null&&r++))}if(s>0&&r!==0&&r!==s)throw new TypeError("All element children must either all have keys or none.");return e};const yt={}.hasOwnProperty,Et={},Ae=/(^|#|\.)([^#\.]+)/g,K=Object.create(null),Re=1e3;let Q=0;const Pe=t=>{for(const e in t)if(yt.call(t,e))return!1;return!0};function Le(t){let e,r="div";const s=[];let n={};for(;e=Ae.exec(t);){const c=e[1],a=e[2];c===""&&a!==""?r=a:c==="#"?n.id=a:c==="."&&s.push(a)}s.length&&(n.class=s.join(" ")),Pe(n)&&(n=Et);const o={tag:r,attrs:n};if(Q>=Re){const c=Object.keys(K),a=Math.floor(c.length/2);for(let l=0;l<a;l++)delete K[c[l]];Q-=a}return K[t]=o,Q++,o}function Ne(t,e){e.tag=t.tag;let r=e.attrs;if(r==null)return e.attrs=t.attrs,e;if(t.attrs!==Et){const s={...t.attrs,...r};t.attrs.class!=null&&r.class!=null&&(s.class=t.attrs.class+" "+r.class),e.attrs=s}return e}function i(t,...e){if(typeof t!="string")throw new Error("Selector must be a string");let r=null,s=0;function n(l){return l!=null&&typeof l=="object"&&typeof l.tag=="string"&&"children"in l&&"attrs"in l}if(e.length){const l=e[0];(l==null||typeof l=="object"&&!Array.isArray(l)&&!n(l))&&(r=l,s=1)}const o=C.normalizeChildren(e.slice(s)),c=C("",r&&r.key,r||null,o,null,null),a=K[t]||Le(t);return Ne(a,c)}const Oe={svg:"http://www.w3.org/2000/svg",math:"http://www.w3.org/1998/Math/MathML"};function Ce(t){return t.attrs&&t.attrs.xmlns||Oe[t.tag]}function W(t,e,r,s,n,o){for(let c=r;c<s;c++){const a=e[c];z(t,a,n,o)}}function z(t,e,r,s){if(e.tag==="#"){const n=t.ownerDocument;if(!n)throw new Error("Parent node has no ownerDocument");const o=e.dom=n.createTextNode(e.text||"");et(t,o,r)}else $e(t,e,s,r)}function $e(t,e,r,s){const n=e.tag,o=e.attrs;r=Ce(e)||r;const c=t.ownerDocument,a=r!=null?c.createElementNS(r,n):c.createElement(n);e.dom=a,o!=null&&Ie(e,o),et(t,a,s);const l=e.children;l!=null&&W(a,l,0,l.length,null,r)}function bt(t,e,r,s,n){const o=e||[],c=r||[];if(o===c)return;const a=o.length,l=c.length;if(a===0){l>0&&W(t,c,0,l,s,n);return}if(l===0){X(t,o,0,a);return}const m=o[0]!=null&&o[0].key!=null,S=c[0]!=null&&c[0].key!=null;if(m!==S){X(t,o,0,a),W(t,c,0,l,s,n);return}if(!S){const h=Math.min(a,l);for(let y=0;y<h;y++){const v=o[y],P=c[y];if(v===P)continue;const G=De(o,y+1,s);at(t,v,P,G,n)}a>h&&X(t,o,h,a),l>h&&W(t,c,h,l,s,n);return}const A=new Map;for(let h=0;h<a;h++){const y=o[h];y!=null&&y.key!=null&&A.set(y.key,h)}const R=new Set,N=new Array(l);for(let h=0;h<l;h++)N[h]=-1;for(let h=0;h<l;h++){const y=c[h],v=y!=null?y.key:null,P=v!=null?A.get(v)??-1:-1;if(N[h]=P,P>=0){const G=o[P];R.add(P),G!==y&&at(t,G,y,null,n)}}for(let h=0;h<a;h++)R.has(h)||Y(t,o[h]);const g=N,f=Te(g),u=new Set(f);let _=s;for(let h=l-1;h>=0;h--){const y=c[h];if(!y)continue;const v=g[h];let P=y.dom;v<0?(z(t,y,_,n),P=y.dom):!u.has(h)&&P&&P.nextSibling!==_&&et(t,P,_),_=P}}function at(t,e,r,s,n){if(e!==r){if(e.tag==="#"&&r.tag==="#"){r.dom=e.dom;const o=e.dom;o&&e.text!==r.text&&(o.nodeValue=r.text??"");return}if(e.tag===r.tag){const o=n,c=r.tag==="svg"?"http://www.w3.org/2000/svg":n;if(o!==c){z(t,r,s,c),Y(t,e);return}r.dom=e.dom,e.attrs!==r.attrs&&He(r,e.attrs,r.attrs),bt(r.dom,e.children,r.children,null,c);return}else Y(t,e),z(t,r,s,n)}}function et(t,e,r){r?t.insertBefore(e,r):t.appendChild(e)}function X(t,e,r,s){for(let n=r;n<s;n++){const o=e[n];Y(t,o)}}function Y(t,e){const r=e.dom;r&&r.parentNode===t&&t.removeChild(r)}function De(t,e,r){for(;e<t.length;e++){const s=t[e];if(s&&s.dom)return s.dom}return r}function Ie(t,e,r){for(const s in e)yt.call(e,s)&&St(t,s,null,e[s])}function St(t,e,r,s,n){if(e==="key")return;const o=t.dom;if(e.startsWith("on")){o[e]=typeof s=="function"?s:null;return}if(s==null){kt(t,e,r);return}if(e==="value"){o.value!==s&&(o.value=s);return}if(e==="checked"){o.checked!==!!s&&(o.checked=!!s);return}if(e==="selected"){o.selected!==!!s&&(o.selected=!!s);return}if(e==="style"){_t(o,r,s);return}if(e==="class"){o.setAttribute("class",s);return}if(typeof s=="boolean"){s?o.setAttribute(e,""):o.removeAttribute(e);return}o.setAttribute(e,String(s))}function kt(t,e,r,s){const n=t.dom;if(e.startsWith("on")){n[e]=null;return}if(e==="style"){_t(n,r,null);return}if(e==="class"){n.removeAttribute("class");return}n.removeAttribute(e)}function He(t,e,r,s){if(e)for(const n in e){const o=e[n];o!=null&&(!r||r[n]==null)&&kt(t,n,o)}if(r)for(const n in r){const o=r[n],c=e&&e[n];o!==c&&St(t,n,c,o)}}function _t(t,e,r){if(r==null){t.removeAttribute("style");return}if(typeof r=="string"){t.setAttribute("style",r);return}t.removeAttribute("style");for(const s in r){const n=r[s];n!=null&&(s.includes("-")?t.style.setProperty(s,String(n)):t.style[s]=String(n))}}function Me(t,e){if(!t)throw new TypeError("Root DOM is null");const r=t.namespaceURI,s=t.vnodes;s==null&&(t.textContent="");const n=C.normalizeChildren(Array.isArray(e)?e:[e]);bt(t,s,n,null,r==="http://www.w3.org/1999/xhtml"?void 0:r??void 0),t.vnodes=n}const Fe=Symbol("IOEffect"),xe=Symbol("ReaderEffect"),J=E(t=>t);J.map(t=>t.document);J.map(t=>t.window);J.map(t=>t.localStorage);J.map(t=>t.sessionStorage);J.map(t=>t.fetch);const Ve=()=>{if(typeof window>"u"||typeof document>"u")throw new Error("browserEnv() called in a non-browser environment. Use a custom DomEnv implementation when running SSR or tests.");return{document:window.document,window,localStorage:window.localStorage,sessionStorage:window.sessionStorage,fetch:window.fetch.bind(window)}},Be=(t,e=Ve())=>(r,s)=>r.map(n=>{let o;const c=[];let a=!1,l=!1;const m=g=>{g?.forEach(f=>{if(!f)return;if(f._tag===Fe){f.io.run();return}if(f._tag===xe){f.reader.run(e).run();return}const u=f;if(typeof u.run=="function")switch(u.run.length){case 0:u.run();return;case 1:const h=u.run(e);h&&typeof h.run=="function"&&h.run();return;default:u.run(e,R);return}})},S=(g,f)=>{t(n,s.view(g,R)),m(f)},A=g=>{if(o===void 0||l)return;const{model:f,effects:u}=s.update(g,o,R);o=f,S(o,u)},R=g=>{l||(c.push(g),a||(a=!0,requestAnimationFrame(()=>{if(l)return;const f=c.splice(0,c.length);a=!1;for(const u of f)A(u)})))},N=()=>{const{model:g,effects:f}=s.init.run();o=g,S(o,f)};return d(()=>(N(),{dispatch:R,getModel:()=>o,destroy:()=>{l=!0,c.length=0,a=!0}}))}).chain(n=>n),U=E(t=>t);U.map(t=>t.document);U.map(t=>t.window);U.map(t=>t.localStorage);U.map(t=>t.sessionStorage);U.map(t=>t.fetch);const Je={},Ue=()=>({document:window.document,window,localStorage:window.localStorage,sessionStorage:window.sessionStorage,fetch:window.fetch.bind(window),apiKey:Je?.VITE_ALPHA_VANTAGE_KEY??"VITE_ALPHA_VANTAGE_KEY",baseUrl:"https://www.alphavantage.co"}),Ge=(t,e)=>{Me(t,e)},qe=d(()=>({model:{holdings:[],input:{ticker:"",shares:""},editingShares:{},validationErrors:[],fetchingPrices:new Set,priceErrors:new Map},effects:[]})),F=(t,e)=>I.Failure([{field:t,message:e}]),rt=t=>I.Success(t),je=t=>{const e=t.trim().toUpperCase();return e.length===0?F("ticker","Ticker is required"):/^[A-Z]{1,5}$/.test(e)?rt(e):F("ticker","Ticker must be 1â€“5 uppercase letters")},Ke=t=>{const e=t.trim();if(!e)return F("shares","Shares required");const r=Number(e);return Number.isFinite(r)?r<=0?F("shares","Shares must be > 0"):rt(r):F("shares","Shares must be numeric")},lt=(t,e)=>{const r=je(t),s=Ke(e),n=o=>c=>({ticker:o,shares:c});return I.ap(I.ap(I.Success(n),r),s)},We=(t,e)=>e.some(r=>r.ticker===t)?F("ticker",`Ticker ${t} already exists`):rt(null),ze="holdings",wt="price-cache",Ye=t=>{try{const e=JSON.parse(t);return k.of(e)}catch{return k.Nothing}},Qe=t=>E(e=>d(()=>{const r=e.localStorage.getItem(t);return k.fromNullable(r)})),vt=(t,e)=>E(r=>d(()=>{r.localStorage.setItem(t,e)})),q=t=>E(e=>d(()=>{const r=JSON.stringify(t);vt(ze,r).run(e).run()})),Xe={},Tt=E(t=>d(()=>{const e=Qe(wt).run(t).run(),r=k.chain(s=>Ye(s),e);return k.getOrElse(Xe,r)})),Ze=t=>E(e=>d(()=>{const r=JSON.stringify(t);vt(wt,r).run(e).run()})),tr=(t,e)=>E(r=>d(()=>{const n=Tt.run(r).run()[t];return!n||Date.now()-n.timestamp>e?k.Nothing:k.of(n.price)})),er=(t,e)=>E(r=>d(()=>{const n={...Tt.run(r).run(),[t]:{price:e,timestamp:Date.now()}};Ze(n).run(r).run()})),rr=(t,e)=>{const r=t.baseUrl??"https://www.alphavantage.co",s=new URLSearchParams;return s.set("function","GLOBAL_QUOTE"),s.set("symbol",e),t.apiKey&&s.set("apikey",t.apiKey),`${r}/query?${s.toString()}`},sr=t=>E(e=>p(()=>e.fetch(t).then(r=>r.ok?r.json().then(s=>L.Right(s)).catch(s=>L.Left({_tag:"DecodeError",message:s instanceof Error?s.message:String(s)})):L.Left({_tag:"HttpError",status:r.status,message:r.statusText})).catch(r=>{const s=r instanceof Error?r.message:String(r);return r?.name==="AbortError"?L.Left({_tag:"AbortError",message:s}):L.Left({_tag:"NetworkError",message:s})}))),nr=t=>{if(typeof t!="object"||t===null)return L.Left({_tag:"DecodeError",message:"JSON root is not an object"});const r=t["Global Quote"];if(typeof r!="object"||r===null)return L.Left({_tag:"DecodeError",message:"Missing Global Quote field"});const s=r,n=s["01. symbol"],o=s["05. price"];if(typeof n!="string")return L.Left({_tag:"DecodeError",message:"Missing or invalid symbol"});if(typeof o!="string")return L.Left({_tag:"DecodeError",message:"Missing or invalid price"});const c=Number(o);return Number.isFinite(c)?L.Right({symbol:n,price:c}):L.Left({_tag:"DecodeError",message:"Price is not numeric"})},or=t=>E(e=>{const r=rr(e,t);return sr(r).run(e).chain(n=>p.fromEither(nr(n)))}),cr=t=>{switch(t._tag){case"NetworkError":case"AbortError":return t.message;case"HttpError":return`HTTP ${t.status}: ${t.message}`;case"DecodeError":return`Decode error: ${t.message}`}},ir=5*60*1e3,ar=(t,e,r)=>d(()=>{t({type:"PRICE_FETCHED",ticker:e,price:r})}),lr=(t,e,r)=>d(()=>{t({type:"PRICE_ERROR",ticker:e,error:r})}),j=(t,e)=>or(t).map(r=>d(()=>{r.run().then(s=>{if(L.isRight(s)){const n=s.right;ar(e,t,n.price).run()}else{const n=s.left;lr(e,t,cr(n)).run()}})})),ur=(t,e)=>k.fold(()=>0,r=>t*r,e),fr=(t,e,r)=>r<=0?t.filter(s=>s.ticker!==e):t.map(s=>s.ticker===e?{...s,shares:r,value:ur(r,s.currentPrice)}:s),dr=(t,e,r)=>{switch(t.type){case"SET_TICKER":return{model:{...e,input:{...e.input,ticker:t.value.toUpperCase()},validationErrors:[]},effects:[]};case"SET_SHARES":return{model:{...e,input:{...e.input,shares:t.value},validationErrors:[]},effects:[]};case"ADD_HOLDING":{const s=lt(e.input.ticker,e.input.shares);if(s._tag==="Failure"){const m=s.errors;return{model:{...e,validationErrors:m},effects:[]}}const{ticker:n,shares:o}=s.value,c=We(n,e.holdings);if(c._tag==="Failure"){const m=c.errors;return{model:{...e,validationErrors:m},effects:[]}}const a=tr(n,ir),l=E(m=>d(()=>{const S=a.run(m).run(),A=k.getOrElse(0,S),R=k.isNothing(S)?k.Nothing:k.of(A),N={ticker:n,shares:o,currentPrice:R,value:A>0?o*A:0},g=[...e.holdings,N];q(g).run(m).run(),k.isNothing(S)&&j(n,r).run(m).run(),r({type:"SET_HOLDINGS",holdings:g})}));return{model:{...e,input:{ticker:"",shares:""},validationErrors:[]},effects:[l]}}case"REMOVE_HOLDING":{const s=e.holdings.filter(o=>o.ticker!==t.ticker),n=q(s);return{model:{...e,holdings:s},effects:[n]}}case"FETCH_PRICE":{const s=j(t.ticker,r);return{model:{...e,fetchingPrices:new Set([...e.fetchingPrices,t.ticker]),priceErrors:new Map([...e.priceErrors].filter(([n])=>n!==t.ticker))},effects:[s]}}case"PRICE_FETCHED":{const s=e.holdings.map(a=>a.ticker===t.ticker?{...a,currentPrice:k.of(t.price),value:a.shares*t.price}:a),n=new Set(e.fetchingPrices);n.delete(t.ticker);const o=q(s),c=er(t.ticker,t.price);return{model:{...e,holdings:s,fetchingPrices:n},effects:[o,c]}}case"PRICE_ERROR":{const s=new Set(e.fetchingPrices);s.delete(t.ticker);const n=new Map(e.priceErrors);return n.set(t.ticker,t.error),{model:{...e,fetchingPrices:s,priceErrors:n},effects:[]}}case"REFRESH_ALL_PRICES":{const s=e.holdings.map(n=>j(n.ticker,r));return{model:{...e,fetchingPrices:new Set(e.holdings.map(n=>n.ticker)),priceErrors:new Map},effects:s}}case"SET_EDITING_SHARES":{const s={...e.editingShares,[t.ticker]:t.value};return{model:{...e,editingShares:s,validationErrors:[]},effects:[]}}case"APPLY_EDITING_SHARES":{const s=e.editingShares[t.ticker];if(s==null||s.trim()==="")return{model:e,effects:[]};const n=lt(t.ticker,s);if(n._tag==="Failure"){const f=n.errors;return{model:{...e,validationErrors:f},effects:[]}}const{shares:o}=n.value,c=e.holdings.find(f=>f.ticker===t.ticker);if(!c)return{model:e,effects:[]};if(c.shares===o){const{[t.ticker]:f,...u}=e.editingShares;return{model:{...e,editingShares:u,validationErrors:[]},effects:[]}}const a=fr(e.holdings,t.ticker,o),l=q(a),m=j(t.ticker,r),S=new Set(e.fetchingPrices);S.add(t.ticker);const A=new Map([...e.priceErrors].filter(([f])=>f!==t.ticker)),{[t.ticker]:R,...N}=e.editingShares,g=d(()=>{r({type:"SET_HOLDINGS",holdings:a})});return{model:{...e,holdings:a,editingShares:N,validationErrors:[],fetchingPrices:S,priceErrors:A},effects:[l,m,g]}}case"CLEAR_VALIDATION_ERRORS":return{model:{...e,validationErrors:[]},effects:[]};default:return{model:e,effects:[]}}},O=t=>{const e=["BND","AGG","TLT","IEF","VGIT","BSV","MUB","LQD","HYG"],r=t.toUpperCase();return e.includes(r)?"bonds":"stocks"},At=t=>t.reduce((e,r)=>e+r.value,0),hr=b(t=>{const e=At(t);if(e===0)return[{stocks:0,bonds:0,cash:0},t];const r=t.filter(c=>O(c.ticker)==="stocks").reduce((c,a)=>c+a.value,0),s=t.filter(c=>O(c.ticker)==="bonds").reduce((c,a)=>c+a.value,0);return[{stocks:r/e*100,bonds:s/e*100,cash:0/e*100},t]}),Z=t=>b(e=>{const r=At(e),[s]=hr.run(e),n={stocks:s.stocks-t.stocks,bonds:s.bonds-t.bonds,cash:s.cash-t.cash};return[{current:s,target:t,drift:n,totalValue:r},e]}),gr=(t,e)=>{const{totalValue:r,target:s}=t,n={stocks:r*s.stocks/100,bonds:r*s.bonds/100,cash:r*s.cash/100},o=e.filter(g=>O(g.ticker)==="stocks").reduce((g,f)=>g+f.value,0),c=e.filter(g=>O(g.ticker)==="bonds").reduce((g,f)=>g+f.value,0),a={stocks:n.stocks-o,bonds:n.bonds-c},l=[];let m=0;if(a.stocks<0){const g=Math.abs(a.stocks);e.filter(u=>O(u.ticker)==="stocks").forEach(u=>{const _=u.value/o,h=g*_,y=k.getOrElse(0,u.currentPrice);if(y>0){const v=Math.floor(h/y);v>0&&(l.push({action:"sell",ticker:u.ticker,shares:v,price:y,total:v*y}),m+=v*y)}})}if(a.bonds<0){const g=Math.abs(a.bonds);e.filter(u=>O(u.ticker)==="bonds").forEach(u=>{const _=u.value/c,h=g*_,y=k.getOrElse(0,u.currentPrice);if(y>0){const v=Math.floor(h/y);v>0&&(l.push({action:"sell",ticker:u.ticker,shares:v,price:y,total:v*y}),m+=v*y)}})}if(a.stocks>0){const g=a.stocks,f=e.find(u=>O(u.ticker)==="stocks");if(f){const u=k.getOrElse(0,f.currentPrice);if(u>0){const _=Math.floor(g/u);_>0&&(l.push({action:"buy",ticker:f.ticker,shares:_,price:u,total:_*u}),m-=_*u)}}}if(a.bonds>0){const g=a.bonds,f=e.find(u=>O(u.ticker)==="bonds");if(f){const u=k.getOrElse(0,f.currentPrice);if(u>0){const _=Math.floor(g/u);_>0&&(l.push({action:"buy",ticker:f.ticker,shares:_,price:u,total:_*u}),m-=_*u)}}}let S=o,A=c;l.forEach(g=>{const f=O(g.ticker),u=g.total;g.action==="buy"?(f==="stocks"&&(S+=u),f==="bonds"&&(A+=u)):(f==="stocks"&&(S-=u),f==="bonds"&&(A-=u))});const R=S+A+Math.abs(m),N={stocks:S/R*100,bonds:A/R*100,cash:Math.abs(m)/R*100};return{trades:l,finalAllocation:N,cashNeeded:-m}},M=t=>new Intl.NumberFormat("en-US",{style:"currency",currency:"USD",minimumFractionDigits:0,maximumFractionDigits:0}).format(t),x=t=>`${t.toFixed(1)}%`,pr=(t,e)=>{const r=t.validationErrors.map(n=>`${n.field}: ${n.message}`),s=t.holdings.map(n=>{let o;return k.isJust(n.currentPrice)?o=M(k.getOrElse(0,n.currentPrice)):t.fetchingPrices.has(n.ticker)?o="Loading...":o={kind:"button",label:"Fetch"},{ticker:n.ticker,shares:n.shares.toString(),price:o,value:M(n.value),removeAction:()=>e({type:"REMOVE_HOLDING",ticker:n.ticker})}});return{editingShares:{},inputTicker:t.input.ticker,inputShares:t.input.shares,errors:r,rows:s,hasHoldings:s.length>0,refreshAction:()=>e({type:"REFRESH_ALL_PRICES"})}},mr=(t,e)=>{const r=pr(t,e);return console.log(r,t),i("div",[i("form",{onsubmit:s=>{s.preventDefault(),e({type:"ADD_HOLDING"})}},[i("div",{style:"display:grid;grid-template-columns:1fr 1fr auto;gap:0.5rem;"},[i("input",{type:"text",placeholder:"Ticker (e.g., AAPL)",value:r.inputTicker,oninput:s=>e({type:"SET_TICKER",value:s.target.value})}),i("input",{type:"number",placeholder:"Shares",value:r.inputShares,oninput:s=>e({type:"SET_SHARES",value:s.target.value})}),i("button",{type:"submit"},"Add")])]),r.errors.length>0?i("ul",{style:"color: var(--pico-del-color); margin-top:0.5rem;"},r.errors.map(s=>i("li",s))):null,r.hasHoldings?i("figure",{style:"margin-top:1rem;"},[i("table",[i("thead",[i("tr",[i("th","Ticker"),i("th","Shares"),i("th","Price"),i("th","Value"),i("th","")])]),i("tbody",r.rows.map(s=>i("tr",[i("td",s.ticker),i("td",s.shares),i("td",Array.isArray(s.price)||typeof s.price=="string"?s.price:i("button",{onclick:s.price.kind==="button"?()=>e({type:"FETCH_PRICE",ticker:s.ticker}):void 0,style:"padding:0.25rem 0.5rem;font-size:0.8rem;"},s.price.label)),i("td",s.value),i("td",[i("button",{onclick:s.removeAction,class:"secondary outline",style:"padding:0.25rem 0.5rem;font-size:0.8rem;"},"Remove"),i("input",{value:r.editingShares[s.ticker]??String(s.shares),oninput:n=>e({type:"SET_EDITING_SHARES",ticker:s.ticker,value:n.target.value})}),i("button",{onclick:()=>e({type:"APPLY_EDITING_SHARES",ticker:s.ticker})},"Update shares")])])))])]):i("p",{style:"color: var(--pico-muted-color);"},"No holdings yet. Add your first position above."),r.hasHoldings?i("button",{onclick:r.refreshAction,class:"secondary",style:"margin-top:1rem;"},"Refresh All Prices"):null])},yr=mr,st={init:qe,update:dr,view:yr},Er={stocks:60,bonds:30,cash:10},br=t=>{const e=[];return t.stocks+t.bonds+t.cash!==100&&e.push({field:"total",message:"Allocation must sum to 100%"}),(t.stocks<0||t.bonds<0||t.cash<0)&&e.push({field:"allocation",message:"Allocations cannot be negative"}),e.length>0?I.Failure(e):I.Success(t)},Sr=d(()=>({model:{target:Er,validationErrors:[],isLoaded:!1},effects:[]})),kr=(t,e,r)=>{switch(t.type){case"SET_STOCKS":return{model:{...e,target:{...e.target,stocks:t.value}},effects:[]};case"SET_BONDS":return{model:{...e,target:{...e.target,bonds:t.value}},effects:[]};case"SET_CASH":return{model:{...e,target:{...e.target,cash:t.value}},effects:[]};case"APPLY":{const s=br(e.target);if(s._tag==="Failure"){const n=s.errors;return{model:{...e,validationErrors:n},effects:[]}}return{model:{...e,validationErrors:[]},effects:[]}}case"LOADED_TARGET":return{model:{...e,target:t.target,isLoaded:!0,validationErrors:[]},effects:[]};default:return{model:e,effects:[]}}},_r=(t,e)=>{const{stocks:r,bonds:s,cash:n}=t.target,o=r+s+n,c=t.validationErrors.map(a=>`${a.field}: ${a.message}`);return{stocks:r,bonds:s,cash:n,total:o,formatted:{stocks:x(r),bonds:x(s),cash:x(n)},canApply:c.length===0,errors:c,setStocks:a=>e({type:"SET_STOCKS",value:a}),setBonds:a=>e({type:"SET_BONDS",value:a}),setCash:a=>e({type:"SET_CASH",value:a}),apply:()=>e({type:"APPLY"}),reset:()=>e({type:"RESET_DEFAULT"})}},wr=(t,e)=>{const r=_r(t,e),s=r.errors.length>0?[i("ul",{style:"color: var(--pico-del-color); margin-top: 0.5rem;"},r.errors.map(n=>i("li",n)))]:[];return i("div",[i("div",{class:"grid",style:"grid-template-columns: 1fr 3fr;"},[i("label",{for:"stocks-slider"},"Stocks"),i("input",{id:"stocks-slider",type:"range",min:0,max:100,value:r.stocks,oninput:n=>r.setStocks(Number(n.target.value))})]),i("small",`Stocks: ${r.formatted.stocks}`),i("div",{class:"grid",style:"grid-template-columns: 1fr 3fr;"},[i("label",{for:"bonds-slider"},"Bonds"),i("input",{id:"bonds-slider",type:"range",min:0,max:100,value:r.bonds,oninput:n=>r.setBonds(Number(n.target.value))})]),i("small",`Bonds: ${r.formatted.bonds}`),i("div",{class:"grid",style:"grid-template-columns: 1fr 3fr;"},[i("label",{for:"cash-slider"},"Cash"),i("input",{id:"cash-slider",type:"range",min:0,max:100,value:r.cash,oninput:n=>r.setCash(Number(n.target.value))})]),i("small",`Cash: ${r.formatted.cash}`),i("p",{style:"margin-top: 0.5rem;"},[i("strong","Total: "),`${r.total}%`]),i("div",{class:"grid",style:"margin-top: 0.75rem;"},[i("button",{onclick:r.apply,disabled:!r.canApply},"Apply target"),i("button",{class:"secondary outline",onclick:r.reset},"Reset to 60/30/10")]),...s])},nt={init:Sr,update:kr,view:wr},vr=d(()=>({model:{report:null},effects:[]})),Tr=(t,e,r)=>{switch(t.type){case"CALCULATE":return console.log("driuft calculate",t,e),{model:e,effects:[]};case"CLEAR":return{model:{report:null},effects:[]};case"SET_REPORT":return{model:{report:t.report},effects:[]}}},tt=t=>Math.abs(t)<1?"drift-green":Math.abs(t)<=5?"drift-yellow":"drift-red",Ar=t=>t?[{asset:"Stocks",current:t.current.stocks.toFixed(1)+"%",target:t.target.stocks.toFixed(1)+"%",drift:t.drift.stocks.toFixed(1)+"%",driftClass:tt(t.drift.stocks)},{asset:"Bonds",current:t.current.bonds.toFixed(1)+"%",target:t.target.bonds.toFixed(1)+"%",drift:t.drift.bonds.toFixed(1)+"%",driftClass:tt(t.drift.bonds)},{asset:"Cash",current:t.current.cash.toFixed(1)+"%",target:t.target.cash.toFixed(1)+"%",drift:t.drift.cash.toFixed(1)+"%",driftClass:tt(t.drift.cash)}]:[],Rr=(t,e)=>{const r=Ar(t.report);return r.length===0?i("p",{style:"color: var(--pico-muted-color);"},["No drift data available."]):i("div",[i("figure",[i("table",[i("thead",[i("tr",[i("th","Asset"),i("th","Current"),i("th","Target"),i("th","Drift")])]),i("tbody",r.map(s=>i("tr",[i("td",s.asset),i("td",s.current),i("td",s.target),i("td",{class:s.driftClass},s.drift)])))])])])},ot={init:vr,update:Tr,view:Rr},Pr=d(()=>({model:{plan:null},effects:[]})),Lr=(t,e,r)=>{switch(t.type){case"SET_PLAN":return{model:{plan:t.plan},effects:[]};case"CLEAR":return{model:{plan:null},effects:[]};default:return{model:e,effects:[]}}},Nr=t=>{if(!t)return{hasPlan:!1,hasTrades:!1,summaryText:"",trades:[]};const{finalAllocation:e,cashNeeded:r,trades:s}=t,n=`Final allocation: Stocks ${x(e.stocks)}, Bonds ${x(e.bonds)}, Cash ${x(e.cash)}. `,o=r>0?`Add ${M(r)} of new cash.`:r<0?`You will receive ${M(Math.abs(r))} of cash.`:"No net cash movement required.",c=s.map(a=>({action:a.action.toUpperCase(),ticker:a.ticker,shares:a.shares.toString(),price:M(a.price),total:M(a.total)}));return{hasPlan:!0,hasTrades:s.length>0,summaryText:n+o,trades:c}},Or=(t,e)=>{const r=Nr(t.plan);if(!r.hasPlan)return i("p",{style:"color: var(--pico-muted-color);"},"No trade plan generated yet.");const s=i("p",{style:"font-size: 0.9rem; color: var(--pico-muted-color);"},r.summaryText);return r.hasTrades?i("div",[s,i("figure",[i("table",[i("thead",[i("tr",[i("th","Action"),i("th","Ticker"),i("th","Shares"),i("th","Price"),i("th","Total")])]),i("tbody",r.trades.map((n,o)=>i("tr",{key:o},[i("td",n.action),i("td",n.ticker),i("td",n.shares),i("td",n.price),i("td",n.total)])))])])]):i("div",[s,i("p",{style:"color: var(--pico-muted-color);"},"No trades required. Allocation is within tolerance.")])},ct={init:Pr,update:Lr,view:Or},Cr=d(()=>({model:{entries:[]},effects:[]})),$r=(t,e,r)=>{switch(t.type){case"ADD_ENTRY":return{model:{...e,entries:[t.entry,...e.entries]},effects:[]};case"CLEAR":return{model:{...e,entries:[]},effects:[]};case"EXPORT_JSON":{const s=JSON.stringify(e.entries,null,2),n=d(()=>{const o=new Blob([s],{type:"application/json"}),c=URL.createObjectURL(o),a=document.createElement("a");a.href=c,a.download=`fp-rebalance-audit-${Date.now()}.json`,document.body.appendChild(a),a.click(),a.remove(),URL.revokeObjectURL(c)});return{model:e,effects:[n]}}default:return{model:e,effects:[]}}},Dr=(t,e)=>{const r=t.entries.map(s=>({summary:`[${s.timestamp}] ${s.operation} (${s.success?"ok":"error"})`,details:JSON.stringify(s.details,null,2)}));return{entries:r,hasEntries:r.length>0,exportJson:()=>e({type:"EXPORT_JSON"}),clear:()=>e({type:"CLEAR"})}},Ir=(t,e)=>{const r=Dr(t,e);return i("div",[i("div",{style:"display:flex; gap:0.5rem; margin-bottom:0.5rem;"},[i("button",{onclick:r.exportJson,class:"secondary"},"Export JSON"),r.hasEntries?i("button",{onclick:r.clear,class:"secondary outline"},"Clear"):null]),r.hasEntries?i("div",{style:"max-height: 260px; overflow-y: auto; font-size: 0.8rem; border: 1px solid var(--pico-muted-border-color); border-radius: 0.5rem; padding: 0.5rem;"},r.entries.map((s,n)=>i("details",{key:n},[i("summary",s.summary),i("pre",s.details)]))):i("p",{style:"color: var(--pico-muted-color);"},"No audit entries yet.")])},Hr=Ir,it={init:Cr,update:$r,view:Hr},Mr=d(()=>{const t=st.init.run(),e=nt.init.run(),r=ot.init.run(),s=ct.init.run(),n=it.init.run(),o={holdings:t.model,targets:e.model,drift:r.model,trades:s.model,audit:n.model},c=[...t.effects,...e.effects,...r.effects,...s.effects,...n.effects];return{model:o,effects:c}}),B=(t,e,r)=>(s,n,o)=>{const{model:c,effects:a}=t(s.msg,n[e],m=>o(r(m)));return{model:{...n,[e]:c},effects:a}},Fr=(t,e,r)=>{switch(t.type){case"Holdings":{const s=B(st.update,"holdings",c=>({type:"Holdings",msg:c}))(t,e,r),n=t.msg;if(n.type==="PRICE_FETCHED"||n.type==="ADD_HOLDING"||n.type==="REMOVE_HOLDING"){const c=d(()=>{const a=s.model.holdings.holdings,l=s.model.targets.target,[m]=Z(l).run(a);r({type:"Drift",msg:{type:"SET_REPORT",report:m}})});return{model:s.model,effects:[...s.effects,c]}}return s}case"Targets":{const s=B(nt.update,"targets",c=>({type:"Targets",msg:c}))(t,e,r),n=t.msg;if(n.type==="APPLY"||n.type==="RESET_DEFAULT"){const c=d(()=>{const a=s.model.holdings.holdings,l=s.model.targets.target,[m]=Z(l).run(a);r({type:"Drift",msg:{type:"SET_REPORT",report:m}})});return{model:s.model,effects:[...s.effects,c]}}return s}case"Drift":{const s=B(ot.update,"drift",o=>({type:"Drift",msg:o}))(t,e,r),n=t.msg;if(n.type==="SET_REPORT"){const o=n.report,c=d(()=>{const a=gr(o,e.holdings.holdings);r({type:"Trades",msg:{type:"SET_PLAN",plan:a}})});return{model:s.model,effects:[...s.effects,c]}}return s}case"Trades":return B(ct.update,"trades",s=>({type:"Trades",msg:s}))(t,e,r);case"Audit":return B(it.update,"audit",s=>({type:"Audit",msg:s}))(t,e,r);case"RECALCULATE_ALL":{const s=d(()=>{const n=e.holdings.holdings,o=e.targets.target,[c]=Z(o).run(n);r({type:"Drift",msg:{type:"SET_REPORT",report:c}})});return{model:e,effects:[s]}}default:return{model:e,effects:[]}}},xr=(t,e)=>{const r=st.view(t.holdings,a=>e({type:"Holdings",msg:a})),s=nt.view(t.targets,a=>e({type:"Targets",msg:a})),n=ot.view(t.drift,a=>e({type:"Drift",msg:a})),o=ct.view(t.trades,a=>e({type:"Trades",msg:a})),c=it.view(t.audit,a=>e({type:"Audit",msg:a}));return[i("header",[i("h1","FPRebalance"),i("p","Mathematically Correct Portfolio Management")]),i("section",{id:"holdings"},r),i("section",{id:"targets"},s),i("section",{id:"drift"},n),i("section",{id:"trades"},o),i("section",{id:"audit"},c)]},Vr={init:Mr,update:Fr,view:xr},Br=Ue(),Jr=d(()=>{const t=document.getElementById("app");if(!t)throw new Error("Root element #app not found");return t});Be(Ge,Br)(Jr,Vr).run();
