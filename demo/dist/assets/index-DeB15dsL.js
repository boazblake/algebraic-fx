(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))s(n);new MutationObserver(n=>{for(const o of n)if(o.type==="childList")for(const c of o.addedNodes)c.tagName==="LINK"&&c.rel==="modulepreload"&&s(c)}).observe(document,{childList:!0,subtree:!0});function r(n){const o={};return n.integrity&&(o.integrity=n.integrity),n.referrerPolicy&&(o.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?o.credentials="include":n.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function s(n){if(n.ep)return;n.ep=!0;const o=r(n);fetch(n.href,o)}})();const At=Symbol("IOBrand"),f=t=>({[At]:!0,run:t,map:e=>f(()=>e(t())),chain:e=>f(()=>e(t()).run()),ap:e=>f(()=>e.run()(t()))});f.of=t=>f(()=>t);f.map=t=>e=>e.map(t);f.chain=t=>e=>e.chain(t);f.ap=t=>e=>e.ap(t);f.run=t=>t.run();f.sequence=t=>f(()=>t.map(e=>e.run()));f.traverse=t=>e=>f(()=>e.map(r=>t(r).run()));f.tryCatch=(t,e)=>f(()=>{try{return t()}catch(r){return e(r)}});const lt=Symbol("EitherBrand"),T=t=>({_tag:"Left",left:t,[lt]:!0}),_=t=>({_tag:"Right",right:t,[lt]:!0}),Rt=(t,e)=>e._tag==="Right"?_(t(e.right)):e,Pt=(t,e)=>t._tag==="Left"?T(t.left):e._tag==="Left"?T(e.left):_(t.right(e.right)),Lt=(t,e)=>e._tag==="Right"?t(e.right):e,Ot=(t,e,r)=>r._tag==="Left"?T(t(r.left)):_(e(r.right)),Ct=(t,e)=>e._tag==="Left"?T(t(e.left)):e,Nt=(t,e,r)=>r._tag==="Left"?t(r.left):e(r.right),$t=t=>_(t),Dt=(t,e)=>e._tag==="Right"?e.right:t,It=(t,e)=>e._tag==="Right"?e.right:t(e.left),Mt=(t,e)=>t._tag==="Right"?t:e,Ft=t=>t._tag==="Left",xt=t=>t._tag==="Right",Ht=t=>e=>e==null?T(t):_(e),Bt=t=>{try{return _(t())}catch(e){return T(e)}},Vt=(t,e)=>{try{return _(t())}catch(r){return T(e(r))}},Jt=t=>t._tag==="Left"?_(t.left):T(t.right),qt=(t,e,r)=>r._tag==="Right"&&!t(r.right)?T(e(r.right)):r,ut=(t,e)=>{const r=[];for(const s of e){const n=t(s);if(n._tag==="Left")return n;r.push(n.right)}return _(r)},Ut=t=>ut(e=>e,t),L={Left:T,Right:_,map:Rt,ap:Pt,chain:Lt,bimap:Ot,mapLeft:Ct,fold:Nt,of:$t,getOrElse:Dt,getOrElseW:It,alt:Mt,isLeft:Ft,isRight:xt,fromNullable:Ht,tryCatch:Bt,tryCatchK:Vt,swap:Jt,filterOrElse:qt,traverse:ut,sequence:Ut},ft=Symbol("MaybeBrand"),B=t=>({_tag:"Just",value:t,[ft]:!0}),M={_tag:"Nothing",[ft]:!0},jt=(t,e)=>e._tag==="Just"?B(t(e.value)):M,Gt=(t,e)=>t._tag==="Just"&&e._tag==="Just"?B(t.value(e.value)):M,Kt=(t,e)=>e._tag==="Just"?t(e.value):M,Wt=t=>B(t),zt=(t,e,r)=>r._tag==="Nothing"?t():e(r.value),Yt=(t,e)=>e._tag==="Just"?e.value:t,Qt=(t,e)=>e._tag==="Just"?e.value:t(),Xt=(t,e)=>t._tag==="Just"?t:e,Zt=t=>t==null?M:B(t),te=t=>t._tag==="Just"?t.value:null,ee=t=>t._tag==="Just"?t.value:void 0,re=t=>t._tag==="Just",se=t=>t._tag==="Nothing",ne=(t,e)=>e._tag==="Just"&&t(e.value)?e:M,dt=(t,e)=>{const r=[];for(const s of e){const n=t(s);if(n._tag==="Nothing")return M;r.push(n.value)}return B(r)},oe=t=>dt(e=>e,t),k={Just:B,Nothing:M,map:jt,ap:Gt,chain:Kt,of:Wt,fold:zt,getOrElse:Yt,getOrElseW:Qt,alt:Xt,fromNullable:Zt,toNullable:te,toUndefined:ee,isJust:re,isNothing:se,filter:ne,traverse:dt,sequence:oe},ce=Symbol("ReaderBrand"),E=t=>({[ce]:!0,run:t,map:e=>E(r=>e(t(r))),chain:e=>E(r=>e(t(r)).run(r)),ap:e=>E(r=>e.run(r)(t(r)))});E.of=t=>E(()=>t);E.ask=()=>E(t=>t);E.asks=t=>E(t);E.map=t=>e=>e.map(t);E.chain=t=>e=>e.chain(t);E.ap=t=>e=>e.ap(t);E.run=t=>e=>e.run(t);E.local=t=>e=>E(r=>e.run(t(r)));E.sequence=t=>E(e=>t.map(r=>r.run(e)));E.traverse=t=>e=>E(r=>e.map(s=>t(s).run(r)));const ie=Symbol("StateBrand"),b=t=>({[ie]:!0,run:t,map:e=>b(r=>{const[s,n]=t(r);return[e(s),n]}),chain:e=>b(r=>{const[s,n]=t(r);return e(s).run(n)}),ap:e=>b(r=>{const[s,n]=e.run(r),[o,c]=t(n);return[s(o),c]})});b.of=t=>b(e=>[t,e]);b.get=()=>b(t=>[t,t]);b.put=t=>b(()=>[void 0,t]);b.modify=t=>b(e=>[void 0,t(e)]);b.gets=t=>b(e=>[t(e),e]);b.map=t=>e=>e.map(t);b.chain=t=>e=>e.chain(t);b.ap=t=>e=>e.ap(t);b.run=t=>e=>e.run(t);b.evalState=t=>e=>e.run(t)[0];b.execState=t=>e=>e.run(t)[1];b.sequence=t=>b(e=>{let r=e;const s=[];for(const n of t){const[o,c]=n.run(r);s.push(o),r=c}return[s,r]});b.traverse=t=>e=>b.sequence(e.map(t));const ae=Symbol("TaskBrand"),d=t=>({[ae]:!0,run:()=>t(),runWith:e=>{if(!e)throw new Error("Task.runWith requires an AbortSignal. Use run() if cancellation is not needed.");return t(e)},map:e=>d(r=>t(r).then(s=>s._tag==="Right"?_(e(s.right)):s)),chain:e=>d(r=>t(r).then(s=>s._tag==="Right"?e(s.right).runWith(r):Promise.resolve(s))),ap:e=>d(r=>e.runWith(r).then(s=>s._tag==="Right"?t(r).then(n=>n._tag==="Right"?_(s.right(n.right)):n):Promise.resolve(s))),mapError:e=>d(r=>t(r).then(s=>s._tag==="Left"?T(e(s.left)):s)),bimap:(e,r)=>d(s=>t(s).then(n=>n._tag==="Left"?T(e(n.left)):_(r(n.right))))});d.of=t=>d(()=>Promise.resolve(_(t)));d.reject=t=>d(()=>Promise.resolve(T(t)));d.tryCatch=t=>d(()=>t().then(_).catch(T));d.tryCatchK=(t,e)=>d(()=>t().then(_).catch(r=>T(e(r))));d.map=t=>e=>e.map(t);d.chain=t=>e=>e.chain(t);d.ap=t=>e=>e.ap(t);d.mapError=t=>e=>e.mapError(t);d.bimap=(t,e)=>r=>r.bimap(t,e);d.fold=(t,e)=>r=>r.run().then(s=>s._tag==="Left"?t(s.left):e(s.right));d.getOrElse=t=>e=>e.run().then(r=>r._tag==="Right"?r.right:t);d.delay=t=>e=>d(r=>new Promise(s=>{const n=setTimeout(()=>{e.runWith(r).then(s)},t);r&&r.addEventListener("abort",()=>{clearTimeout(n),s(T({message:"Task.delay aborted"}))},{once:!0})}));d.timeout=(t,e)=>r=>d(s=>new Promise(n=>{const o=setTimeout(()=>n(T(e)),t),c=r.runWith(s).then(a=>{clearTimeout(o),n(a)});return s&&s.addEventListener("abort",()=>{clearTimeout(o)}),c}));d.sequence=t=>d(e=>(async()=>{const r=[];for(const s of t){const n=await s.runWith(e);if(n._tag==="Left")return n;r.push(n.right)}return _(r)})());d.traverse=t=>e=>d.sequence(e.map(t));d.all=t=>d(e=>Promise.all(t.map(r=>r.runWith(e))).then(r=>{const s=[];for(const n of r){if(n._tag==="Left")return n;s.push(n.right)}return _(s)}));d.race=t=>d(e=>Promise.race(t.map(r=>r.runWith(e))));d.fromEither=t=>d(()=>Promise.resolve(t));d.toPromise=t=>t.run().then(e=>{if(e._tag==="Left")throw e.left;return e.right});const ht=Symbol("ValidationBrand"),$=t=>({_tag:"Failure",errors:t,[ht]:!0}),D=t=>({_tag:"Success",value:t,[ht]:!0}),le=(t,e)=>e._tag==="Success"?D(t(e.value)):e,ue=(t,e)=>t._tag==="Failure"&&e._tag==="Failure"?$([...t.errors,...e.errors]):t._tag==="Failure"?t:e._tag==="Failure"?e:D(t.value(e.value)),fe=(t,e)=>e._tag==="Success"?t(e.value):e,de=(t,e,r)=>r._tag==="Failure"?$(t(r.errors)):D(e(r.value)),he=(t,e)=>e._tag==="Failure"?$(t(e.errors)):e,pe=t=>D(t),ge=(t,e,r)=>r._tag==="Failure"?t(r.errors):e(r.value),me=(t,e)=>e._tag==="Success"?e.value:t,ye=(t,e)=>e._tag==="Success"?e.value:t(e.errors),Ee=t=>t._tag==="Failure",be=t=>t._tag==="Success",pt=t=>$([t]),we=(t,e)=>t._tag==="Success"?t:e._tag==="Success"?e:$([...t.errors,...e.errors]),ke=t=>{const e=[],r=[];for(const s of t)s._tag==="Success"?e.push(s.value):r.push(...s.errors);return r.length>0?$(r):D(e)},gt=(t,e)=>{const r=[],s=[];for(const n of e){const o=t(n);o._tag==="Success"?r.push(o.value):s.push(...o.errors)}return s.length>0?$(s):D(r)},Se=t=>gt(e=>e,t),_e=(t,e)=>r=>t(r)?D(r):pt(e(r)),I={Failure:$,Success:D,map:le,ap:ue,chain:fe,bimap:de,mapErrors:he,of:pe,fold:ge,getOrElse:me,getOrElseW:ye,isFailure:Ee,isSuccess:be,fail:pt,alt:we,combine:ke,traverse:gt,sequence:Se,fromPredicate:_e};function ve(t){const e=t.length,r=new Array(e),s=[];for(let c=0;c<e;c++){const a=t[c];if(a<0){r[c]=-1;continue}let l=0,m=s.length;for(;l<m;){const S=l+m>>1;t[s[S]]<a?l=S+1:m=S}l===s.length?s.push(c):s[l]=c,r[c]=l>0?s[l-1]:-1}let n=s.length>0?s[s.length-1]:-1;const o=[];for(;n>=0;)o.push(n),n=r[n];return o.reverse(),o}function N(t,e,r,s,n,o){return{tag:t,key:e,attrs:r,children:s||[],text:n,dom:o}}N.normalize=function(t){if(Array.isArray(t)){const e=N.normalizeChildren(t);return e.length>0?e[0]:null}return t==null||typeof t=="boolean"?null:typeof t=="object"?t:N("#",null,null,[],String(t),null)};N.normalizeChildren=function(t){const e=[];let r=0,s=0;for(let n=0;n<t.length;n++){const o=t[n];if(Array.isArray(o)){const a=N.normalizeChildren(o);for(let l=0;l<a.length;l++){const m=a[l];e.push(m),m.tag!=="#"&&(s++,m.key!=null&&r++)}continue}const c=N.normalize(o);c!=null&&(e.push(c),c.tag!=="#"&&(s++,c.key!=null&&r++))}if(s>0&&r!==0&&r!==s)throw new TypeError("All element children must either all have keys or none.");return e};const mt={}.hasOwnProperty,yt={},Te=/(^|#|\.)([^#\.]+)/g,j=Object.create(null),Ae=1e3;let z=0;const Re=t=>{for(const e in t)if(mt.call(t,e))return!1;return!0};function Pe(t){let e,r="div";const s=[];let n={};for(;e=Te.exec(t);){const c=e[1],a=e[2];c===""&&a!==""?r=a:c==="#"?n.id=a:c==="."&&s.push(a)}s.length&&(n.class=s.join(" ")),Re(n)&&(n=yt);const o={tag:r,attrs:n};if(z>=Ae){const c=Object.keys(j),a=Math.floor(c.length/2);for(let l=0;l<a;l++)delete j[c[l]];z-=a}return j[t]=o,z++,o}function Le(t,e){e.tag=t.tag;let r=e.attrs;if(r==null)return e.attrs=t.attrs,e;if(t.attrs!==yt){const s={...t.attrs,...r};t.attrs.class!=null&&r.class!=null&&(s.class=t.attrs.class+" "+r.class),e.attrs=s}return e}function i(t,...e){if(typeof t!="string")throw new Error("Selector must be a string");let r=null,s=0;function n(l){return l!=null&&typeof l=="object"&&typeof l.tag=="string"&&"children"in l&&"attrs"in l}if(e.length){const l=e[0];(l==null||typeof l=="object"&&!Array.isArray(l)&&!n(l))&&(r=l,s=1)}const o=N.normalizeChildren(e.slice(s)),c=N("",r&&r.key,r||null,o,null,null),a=j[t]||Pe(t);return Le(a,c)}const Oe={svg:"http://www.w3.org/2000/svg",math:"http://www.w3.org/1998/Math/MathML"};function Ce(t){return t.attrs&&t.attrs.xmlns||Oe[t.tag]}function G(t,e,r,s,n,o){for(let c=r;c<s;c++){const a=e[c];K(t,a,n,o)}}function K(t,e,r,s){if(e.tag==="#"){const n=t.ownerDocument;if(!n)throw new Error("Parent node has no ownerDocument");const o=e.dom=n.createTextNode(e.text||"");et(t,o,r)}else Ne(t,e,s,r)}function Ne(t,e,r,s){const n=e.tag,o=e.attrs;r=Ce(e)||r;const c=t.ownerDocument,a=r!=null?c.createElementNS(r,n):c.createElement(n);e.dom=a,o!=null&&De(e,o),et(t,a,s);const l=e.children;l!=null&&G(a,l,0,l.length,null,r)}function Et(t,e,r,s,n){const o=e||[],c=r||[];if(o===c)return;const a=o.length,l=c.length;if(a===0){l>0&&G(t,c,0,l,s,n);return}if(l===0){Y(t,o,0,a);return}const m=o[0]!=null&&o[0].key!=null,S=c[0]!=null&&c[0].key!=null;if(m!==S){Y(t,o,0,a),G(t,c,0,l,s,n);return}if(!S){const g=Math.min(a,l);for(let y=0;y<g;y++){const v=o[y],R=c[y];if(v===R)continue;const U=$e(o,y+1,s);at(t,v,R,U,n)}a>g&&Y(t,o,g,a),l>g&&G(t,c,g,l,s,n);return}const A=new Map;for(let g=0;g<a;g++){const y=o[g];y!=null&&y.key!=null&&A.set(y.key,g)}const P=new Set,O=new Array(l);for(let g=0;g<l;g++)O[g]=-1;for(let g=0;g<l;g++){const y=c[g],v=y!=null?y.key:null,R=v!=null?A.get(v)??-1:-1;if(O[g]=R,R>=0){const U=o[R];P.add(R),U!==y&&at(t,U,y,null,n)}}for(let g=0;g<a;g++)P.has(g)||W(t,o[g]);const p=O,h=ve(p),u=new Set(h);let w=s;for(let g=l-1;g>=0;g--){const y=c[g];if(!y)continue;const v=p[g];let R=y.dom;v<0?(K(t,y,w,n),R=y.dom):!u.has(g)&&R&&R.nextSibling!==w&&et(t,R,w),w=R}}function at(t,e,r,s,n){if(e!==r){if(e.tag==="#"&&r.tag==="#"){r.dom=e.dom;const o=e.dom;o&&e.text!==r.text&&(o.nodeValue=r.text??"");return}if(e.tag===r.tag){const o=n,c=r.tag==="svg"?"http://www.w3.org/2000/svg":n;if(o!==c){K(t,r,s,c),W(t,e);return}r.dom=e.dom,e.attrs!==r.attrs&&Ie(r,e.attrs,r.attrs),Et(r.dom,e.children,r.children,null,c);return}else W(t,e),K(t,r,s,n)}}function et(t,e,r){r?t.insertBefore(e,r):t.appendChild(e)}function Y(t,e,r,s){for(let n=r;n<s;n++){const o=e[n];W(t,o)}}function W(t,e){const r=e.dom;r&&r.parentNode===t&&t.removeChild(r)}function $e(t,e,r){for(;e<t.length;e++){const s=t[e];if(s&&s.dom)return s.dom}return r}function De(t,e,r){for(const s in e)mt.call(e,s)&&bt(t,s,null,e[s])}function bt(t,e,r,s,n){if(e==="key")return;const o=t.dom;if(e.startsWith("on")){o[e]=typeof s=="function"?s:null;return}if(s==null){wt(t,e,r);return}if(e==="value"){o.value!==s&&(o.value=s);return}if(e==="checked"){o.checked!==!!s&&(o.checked=!!s);return}if(e==="selected"){o.selected!==!!s&&(o.selected=!!s);return}if(e==="style"){kt(o,r,s);return}if(e==="class"){o.setAttribute("class",s);return}if(typeof s=="boolean"){s?o.setAttribute(e,""):o.removeAttribute(e);return}o.setAttribute(e,String(s))}function wt(t,e,r,s){const n=t.dom;if(e.startsWith("on")){n[e]=null;return}if(e==="style"){kt(n,r,null);return}if(e==="class"){n.removeAttribute("class");return}n.removeAttribute(e)}function Ie(t,e,r,s){if(e)for(const n in e){const o=e[n];o!=null&&(!r||r[n]==null)&&wt(t,n,o)}if(r)for(const n in r){const o=r[n],c=e&&e[n];o!==c&&bt(t,n,c,o)}}function kt(t,e,r){if(r==null){t.removeAttribute("style");return}if(typeof r=="string"){t.setAttribute("style",r);return}t.removeAttribute("style");for(const s in r){const n=r[s];n!=null&&(s.includes("-")?t.style.setProperty(s,String(n)):t.style[s]=String(n))}}function Me(t,e){if(!t)throw new TypeError("Root DOM is null");const r=t.namespaceURI,s=t.vnodes;s==null&&(t.textContent="");const n=N.normalizeChildren(Array.isArray(e)?e:[e]);Et(t,s,n,null,r==="http://www.w3.org/1999/xhtml"?void 0:r??void 0),t.vnodes=n}const Fe=Symbol("IOEffect"),xe=Symbol("ReaderEffect"),J=E(t=>t);J.map(t=>t.document);J.map(t=>t.window);J.map(t=>t.localStorage);J.map(t=>t.sessionStorage);J.map(t=>t.fetch);const He=()=>{if(typeof window>"u"||typeof document>"u")throw new Error("browserEnv() called in a non-browser environment. Use a custom DomEnv implementation when running SSR or tests.");return{document:window.document,window,localStorage:window.localStorage,sessionStorage:window.sessionStorage,fetch:window.fetch.bind(window)}},Be=(t,e=He())=>(r,s)=>r.map(n=>{let o;const c=[];let a=!1,l=!1;const m=p=>{p?.forEach(h=>{if(h){if(h._tag===Fe){h.io.run();return}if(h._tag===xe){h.reader.run(e).run();return}if(typeof h.run=="function"){const u=h;if(u.run.length>=1){const w=u.run(e);w&&typeof w.run=="function"&&w.run();return}u.run()}}})},S=(p,h)=>{t(n,s.view(p,P)),m(h)},A=p=>{if(o===void 0||l)return;const{model:h,effects:u}=s.update(p,o,P);o=h,S(o,u)},P=p=>{l||(c.push(p),a||(a=!0,requestAnimationFrame(()=>{if(l)return;const h=c.splice(0,c.length);a=!1;for(const u of h)A(u)})))},O=()=>{const{model:p,effects:h}=s.init.run();o=p,S(o,h)};return f(()=>(O(),{dispatch:P,getModel:()=>o,destroy:()=>{l=!0,c.length=0,a=!0}}))}).chain(n=>n),q=E(t=>t);q.map(t=>t.document);q.map(t=>t.window);q.map(t=>t.localStorage);q.map(t=>t.sessionStorage);q.map(t=>t.fetch);const Ve={},Je=()=>({document:window.document,window,localStorage:window.localStorage,sessionStorage:window.sessionStorage,fetch:window.fetch.bind(window),apiKey:Ve?.VITE_ALPHA_VANTAGE_KEY??"",baseUrl:"https://www.alphavantage.co"}),qe=(t,e)=>{Me(t,e)},Ue=f(()=>({model:{holdings:[],input:{ticker:"",shares:""},validationErrors:[],fetchingPrices:new Set,priceErrors:new Map},effects:[]})),x=(t,e)=>I.Failure([{field:t,message:e}]),rt=t=>I.Success(t),je=t=>{const e=t.trim().toUpperCase();return e.length===0?x("ticker","Ticker is required"):/^[A-Z]{1,5}$/.test(e)?rt(e):x("ticker","Ticker must be 1â€“5 uppercase letters")},Ge=t=>{const e=t.trim();if(!e)return x("shares","Shares required");const r=Number(e);return Number.isFinite(r)?r<=0?x("shares","Shares must be > 0"):rt(r):x("shares","Shares must be numeric")},Ke=(t,e)=>{const r=je(t),s=Ge(e),n=o=>c=>({ticker:o,shares:c});return I.ap(I.ap(I.Success(n),r),s)},We=(t,e)=>e.some(r=>r.ticker===t)?x("ticker",`Ticker ${t} already exists`):rt(null),ze="holdings",St="price-cache",Ye=t=>{try{const e=JSON.parse(t);return k.of(e)}catch{return k.Nothing}},Qe=t=>E(e=>f(()=>{const r=e.localStorage.getItem(t);return k.fromNullable(r)})),_t=(t,e)=>E(r=>f(()=>{r.localStorage.setItem(t,e)})),Q=t=>E(e=>f(()=>{const r=JSON.stringify(t);_t(ze,r).run(e).run()})),Xe={},vt=E(t=>f(()=>{const e=Qe(St).run(t).run(),r=k.chain(s=>Ye(s),e);return k.getOrElse(Xe,r)})),Ze=t=>E(e=>f(()=>{const r=JSON.stringify(t);_t(St,r).run(e).run()})),tr=(t,e)=>E(r=>f(()=>{const n=vt.run(r).run()[t];return!n||Date.now()-n.timestamp>e?k.Nothing:k.of(n.price)})),er=(t,e)=>E(r=>f(()=>{const n={...vt.run(r).run(),[t]:{price:e,timestamp:Date.now()}};Ze(n).run(r).run()})),rr=(t,e)=>{const r=t.baseUrl??"https://www.alphavantage.co",s=new URLSearchParams;return s.set("function","GLOBAL_QUOTE"),s.set("symbol",e),t.apiKey&&s.set("apikey",t.apiKey),`${r}/query?${s.toString()}`},sr=t=>E(e=>d(async r=>{try{const s=await e.fetch(t,{signal:r});if(!s.ok)return L.Left({_tag:"HttpError",status:s.status,message:s.statusText});const n=await s.json();return L.Right(n)}catch(s){const n=s instanceof Error?s.message:String(s);return s?.name==="AbortError"?L.Left({_tag:"AbortError",message:n}):L.Left({_tag:"NetworkError",message:n})}})),nr=t=>{if(typeof t!="object"||t===null)return L.Left({_tag:"DecodeError",message:"Response is not an object"});const r=t["Global Quote"];if(typeof r!="object"||r===null)return L.Left({_tag:"DecodeError",message:"Missing Global Quote"});const s=r,n=s["01. symbol"],o=s["05. price"];if(typeof n!="string"||typeof o!="string")return L.Left({_tag:"DecodeError",message:"Invalid symbol or price in response"});const c=Number(o);return Number.isFinite(c)?L.Right({symbol:n,price:c}):L.Left({_tag:"DecodeError",message:`Price is not finite: ${o}`})},or=t=>E(e=>{const r=rr(e,t);return sr(r).run(e).chain(n=>d.fromEither(nr(n)))}),cr=t=>{switch(t._tag){case"NetworkError":case"AbortError":return t.message;case"HttpError":return`HTTP ${t.status}: ${t.message}`;case"DecodeError":return`Decode error: ${t.message}`}},ir=5*60*1e3,ar=(t,e,r)=>f(()=>{t({type:"PRICE_FETCHED",ticker:e,price:r})}),lr=(t,e,r)=>f(()=>{t({type:"PRICE_ERROR",ticker:e,error:r})}),X=(t,e)=>or(t).map(r=>f(()=>{r.run().then(s=>{if(L.isRight(s)){const n=s.right;ar(e,t,n.price).run()}else{const n=s.left;lr(e,t,cr(n)).run()}})})),ur=(t,e,r)=>{switch(t.type){case"SET_TICKER":return{model:{...e,input:{...e.input,ticker:t.value.toUpperCase()},validationErrors:[]},effects:[]};case"SET_SHARES":return{model:{...e,input:{...e.input,shares:t.value},validationErrors:[]},effects:[]};case"ADD_HOLDING":{const s=Ke(e.input.ticker,e.input.shares);if(s._tag==="Failure"){const m=s.errors;return{model:{...e,validationErrors:m},effects:[]}}const{ticker:n,shares:o}=s.value,c=We(n,e.holdings);if(c._tag==="Failure"){const m=c.errors;return{model:{...e,validationErrors:m},effects:[]}}const a=tr(n,ir),l=E(m=>f(()=>{const S=a.run(m).run(),A=k.getOrElse(0,S),P=k.isNothing(S)?k.Nothing:k.of(A),O={ticker:n,shares:o,currentPrice:P,value:A>0?o*A:0},p=[...e.holdings,O];Q(p).run(m).run(),k.isNothing(S)&&X(n,r).run(m).run(),r({type:"SET_HOLDINGS",holdings:p})}));return{model:{...e,input:{ticker:"",shares:""},validationErrors:[]},effects:[l]}}case"REMOVE_HOLDING":{const s=e.holdings.filter(o=>o.ticker!==t.ticker),n=Q(s);return{model:{...e,holdings:s},effects:[n]}}case"FETCH_PRICE":{const s=X(t.ticker,r);return{model:{...e,fetchingPrices:new Set([...e.fetchingPrices,t.ticker]),priceErrors:new Map([...e.priceErrors].filter(([n])=>n!==t.ticker))},effects:[s]}}case"PRICE_FETCHED":{const s=e.holdings.map(a=>a.ticker===t.ticker?{...a,currentPrice:k.of(t.price),value:a.shares*t.price}:a),n=new Set(e.fetchingPrices);n.delete(t.ticker);const o=Q(s),c=er(t.ticker,t.price);return{model:{...e,holdings:s,fetchingPrices:n},effects:[o,c]}}case"PRICE_ERROR":{const s=new Set(e.fetchingPrices);s.delete(t.ticker);const n=new Map(e.priceErrors);return n.set(t.ticker,t.error),{model:{...e,fetchingPrices:s,priceErrors:n},effects:[]}}case"REFRESH_ALL_PRICES":{const s=e.holdings.map(n=>X(n.ticker,r));return{model:{...e,fetchingPrices:new Set(e.holdings.map(n=>n.ticker)),priceErrors:new Map},effects:s}}case"CLEAR_VALIDATION_ERRORS":return{model:{...e,validationErrors:[]},effects:[]};default:return{model:e,effects:[]}}},C=t=>{const e=["BND","AGG","TLT","IEF","VGIT","BSV","MUB","LQD","HYG"],r=t.toUpperCase();return e.includes(r)?"bonds":"stocks"},Tt=t=>t.reduce((e,r)=>e+r.value,0),fr=b(t=>{const e=Tt(t);if(e===0)return[{stocks:0,bonds:0,cash:0},t];const r=t.filter(c=>C(c.ticker)==="stocks").reduce((c,a)=>c+a.value,0),s=t.filter(c=>C(c.ticker)==="bonds").reduce((c,a)=>c+a.value,0);return[{stocks:r/e*100,bonds:s/e*100,cash:0/e*100},t]}),Z=t=>b(e=>{const r=Tt(e),[s]=fr.run(e),n={stocks:s.stocks-t.stocks,bonds:s.bonds-t.bonds,cash:s.cash-t.cash};return[{current:s,target:t,drift:n,totalValue:r},e]}),dr=(t,e)=>{const{totalValue:r,target:s}=t,n={stocks:r*s.stocks/100,bonds:r*s.bonds/100,cash:r*s.cash/100},o=e.filter(p=>C(p.ticker)==="stocks").reduce((p,h)=>p+h.value,0),c=e.filter(p=>C(p.ticker)==="bonds").reduce((p,h)=>p+h.value,0),a={stocks:n.stocks-o,bonds:n.bonds-c},l=[];let m=0;if(a.stocks<0){const p=Math.abs(a.stocks);e.filter(u=>C(u.ticker)==="stocks").forEach(u=>{const w=u.value/o,g=p*w,y=k.getOrElse(0,u.currentPrice);if(y>0){const v=Math.floor(g/y);v>0&&(l.push({action:"sell",ticker:u.ticker,shares:v,price:y,total:v*y}),m+=v*y)}})}if(a.bonds<0){const p=Math.abs(a.bonds);e.filter(u=>C(u.ticker)==="bonds").forEach(u=>{const w=u.value/c,g=p*w,y=k.getOrElse(0,u.currentPrice);if(y>0){const v=Math.floor(g/y);v>0&&(l.push({action:"sell",ticker:u.ticker,shares:v,price:y,total:v*y}),m+=v*y)}})}if(a.stocks>0){const p=a.stocks,h=e.find(u=>C(u.ticker)==="stocks");if(h){const u=k.getOrElse(0,h.currentPrice);if(u>0){const w=Math.floor(p/u);w>0&&(l.push({action:"buy",ticker:h.ticker,shares:w,price:u,total:w*u}),m-=w*u)}}}if(a.bonds>0){const p=a.bonds,h=e.find(u=>C(u.ticker)==="bonds");if(h){const u=k.getOrElse(0,h.currentPrice);if(u>0){const w=Math.floor(p/u);w>0&&(l.push({action:"buy",ticker:h.ticker,shares:w,price:u,total:w*u}),m-=w*u)}}}let S=o,A=c;l.forEach(p=>{const h=C(p.ticker),u=p.total;p.action==="buy"?(h==="stocks"&&(S+=u),h==="bonds"&&(A+=u)):(h==="stocks"&&(S-=u),h==="bonds"&&(A-=u))});const P=S+A+Math.abs(m),O={stocks:S/P*100,bonds:A/P*100,cash:Math.abs(m)/P*100};return{trades:l,finalAllocation:O,cashNeeded:-m}},F=t=>new Intl.NumberFormat("en-US",{style:"currency",currency:"USD",minimumFractionDigits:0,maximumFractionDigits:0}).format(t),H=t=>`${t.toFixed(1)}%`,hr=(t,e)=>{const r=t.validationErrors.map(n=>`${n.field}: ${n.message}`),s=t.holdings.map(n=>{let o;return k.isJust(n.currentPrice)?o=F(k.getOrElse(0,n.currentPrice)):t.fetchingPrices.has(n.ticker)?o="Loading...":o={kind:"button",label:"Fetch"},{ticker:n.ticker,shares:n.shares.toString(),price:o,value:F(n.value),removeAction:()=>e({type:"REMOVE_HOLDING",ticker:n.ticker})}});return{inputTicker:t.input.ticker,inputShares:t.input.shares,errors:r,rows:s,hasHoldings:s.length>0,refreshAction:()=>e({type:"REFRESH_ALL_PRICES"})}},pr=(t,e)=>{const r=hr(t,e);return i("div",[i("form",{onsubmit:s=>{s.preventDefault(),e({type:"ADD_HOLDING"})}},[i("div",{style:"display:grid;grid-template-columns:1fr 1fr auto;gap:0.5rem;"},[i("input",{type:"text",placeholder:"Ticker (e.g., AAPL)",value:r.inputTicker,oninput:s=>e({type:"SET_TICKER",value:s.target.value})}),i("input",{type:"number",placeholder:"Shares",value:r.inputShares,oninput:s=>e({type:"SET_SHARES",value:s.target.value})}),i("button",{type:"submit"},"Add")])]),r.errors.length>0?i("ul",{style:"color: var(--pico-del-color); margin-top:0.5rem;"},r.errors.map(s=>i("li",s))):null,r.hasHoldings?i("figure",{style:"margin-top:1rem;"},[i("table",[i("thead",[i("tr",[i("th","Ticker"),i("th","Shares"),i("th","Price"),i("th","Value"),i("th","")])]),i("tbody",r.rows.map(s=>i("tr",[i("td",s.ticker),i("td",s.shares),i("td",Array.isArray(s.price)||typeof s.price=="string"?s.price:i("button",{onclick:s.price.kind==="button"?()=>e({type:"FETCH_PRICE",ticker:s.ticker}):void 0,style:"padding:0.25rem 0.5rem;font-size:0.8rem;"},s.price.label)),i("td",s.value),i("td",[i("button",{onclick:s.removeAction,class:"secondary outline",style:"padding:0.25rem 0.5rem;font-size:0.8rem;"},"Remove")])])))])]):i("p",{style:"color: var(--pico-muted-color);"},"No holdings yet. Add your first position above."),r.hasHoldings?i("button",{onclick:r.refreshAction,class:"secondary",style:"margin-top:1rem;"},"Refresh All Prices"):null])},gr=pr,st={init:Ue,update:ur,view:gr},mr={stocks:60,bonds:30,cash:10},yr=t=>{const e=[];return t.stocks+t.bonds+t.cash!==100&&e.push({field:"total",message:"Allocation must sum to 100%"}),(t.stocks<0||t.bonds<0||t.cash<0)&&e.push({field:"allocation",message:"Allocations cannot be negative"}),e.length>0?I.Failure(e):I.Success(t)},Er=f(()=>({model:{target:mr,validationErrors:[],isLoaded:!1},effects:[]})),br=(t,e,r)=>{switch(t.type){case"SET_STOCKS":return{model:{...e,target:{...e.target,stocks:t.value}},effects:[]};case"SET_BONDS":return{model:{...e,target:{...e.target,bonds:t.value}},effects:[]};case"SET_CASH":return{model:{...e,target:{...e.target,cash:t.value}},effects:[]};case"APPLY":{const s=yr(e.target);if(s._tag==="Failure"){const n=s.errors;return{model:{...e,validationErrors:n},effects:[]}}return{model:{...e,validationErrors:[]},effects:[]}}case"LOADED_TARGET":return{model:{...e,target:t.target,isLoaded:!0,validationErrors:[]},effects:[]};default:return{model:e,effects:[]}}},wr=(t,e)=>{const{stocks:r,bonds:s,cash:n}=t.target,o=r+s+n,c=t.validationErrors.map(a=>`${a.field}: ${a.message}`);return{stocks:r,bonds:s,cash:n,total:o,formatted:{stocks:H(r),bonds:H(s),cash:H(n)},canApply:c.length===0,errors:c,setStocks:a=>e({type:"SET_STOCKS",value:a}),setBonds:a=>e({type:"SET_BONDS",value:a}),setCash:a=>e({type:"SET_CASH",value:a}),apply:()=>e({type:"APPLY"}),reset:()=>e({type:"RESET_DEFAULT"})}},kr=(t,e)=>{const r=wr(t,e),s=r.errors.length>0?[i("ul",{style:"color: var(--pico-del-color); margin-top: 0.5rem;"},r.errors.map(n=>i("li",n)))]:[];return i("div",[i("div",{class:"grid",style:"grid-template-columns: 1fr 3fr;"},[i("label",{for:"stocks-slider"},"Stocks"),i("input",{id:"stocks-slider",type:"range",min:0,max:100,value:r.stocks,oninput:n=>r.setStocks(Number(n.target.value))})]),i("small",`Stocks: ${r.formatted.stocks}`),i("div",{class:"grid",style:"grid-template-columns: 1fr 3fr;"},[i("label",{for:"bonds-slider"},"Bonds"),i("input",{id:"bonds-slider",type:"range",min:0,max:100,value:r.bonds,oninput:n=>r.setBonds(Number(n.target.value))})]),i("small",`Bonds: ${r.formatted.bonds}`),i("div",{class:"grid",style:"grid-template-columns: 1fr 3fr;"},[i("label",{for:"cash-slider"},"Cash"),i("input",{id:"cash-slider",type:"range",min:0,max:100,value:r.cash,oninput:n=>r.setCash(Number(n.target.value))})]),i("small",`Cash: ${r.formatted.cash}`),i("p",{style:"margin-top: 0.5rem;"},[i("strong","Total: "),`${r.total}%`]),i("div",{class:"grid",style:"margin-top: 0.75rem;"},[i("button",{onclick:r.apply,disabled:!r.canApply},"Apply target"),i("button",{class:"secondary outline",onclick:r.reset},"Reset to 60/30/10")]),...s])},nt={init:Er,update:br,view:kr},Sr=f(()=>({model:{report:null},effects:[]})),_r=(t,e,r)=>{switch(t.type){case"CALCULATE":return console.log("driuft calculate",t,e),{model:e,effects:[]};case"CLEAR":return{model:{report:null},effects:[]};case"SET_REPORT":return{model:{report:t.report},effects:[]}}},tt=t=>Math.abs(t)<1?"drift-green":Math.abs(t)<=5?"drift-yellow":"drift-red",vr=t=>t?[{asset:"Stocks",current:t.current.stocks.toFixed(1)+"%",target:t.target.stocks.toFixed(1)+"%",drift:t.drift.stocks.toFixed(1)+"%",driftClass:tt(t.drift.stocks)},{asset:"Bonds",current:t.current.bonds.toFixed(1)+"%",target:t.target.bonds.toFixed(1)+"%",drift:t.drift.bonds.toFixed(1)+"%",driftClass:tt(t.drift.bonds)},{asset:"Cash",current:t.current.cash.toFixed(1)+"%",target:t.target.cash.toFixed(1)+"%",drift:t.drift.cash.toFixed(1)+"%",driftClass:tt(t.drift.cash)}]:[],Tr=(t,e)=>{const r=vr(t.report);return r.length===0?i("p",{style:"color: var(--pico-muted-color);"},["No drift data available."]):i("div",[i("figure",[i("table",[i("thead",[i("tr",[i("th","Asset"),i("th","Current"),i("th","Target"),i("th","Drift")])]),i("tbody",r.map(s=>i("tr",[i("td",s.asset),i("td",s.current),i("td",s.target),i("td",{class:s.driftClass},s.drift)])))])])])},ot={init:Sr,update:_r,view:Tr},Ar=f(()=>({model:{plan:null},effects:[]})),Rr=(t,e,r)=>{switch(t.type){case"SET_PLAN":return{model:{plan:t.plan},effects:[]};case"CLEAR":return{model:{plan:null},effects:[]};default:return{model:e,effects:[]}}},Pr=t=>{if(!t)return{hasPlan:!1,hasTrades:!1,summaryText:"",trades:[]};const{finalAllocation:e,cashNeeded:r,trades:s}=t,n=`Final allocation: Stocks ${H(e.stocks)}, Bonds ${H(e.bonds)}, Cash ${H(e.cash)}. `,o=r>0?`Add ${F(r)} of new cash.`:r<0?`You will receive ${F(Math.abs(r))} of cash.`:"No net cash movement required.",c=s.map(a=>({action:a.action.toUpperCase(),ticker:a.ticker,shares:a.shares.toString(),price:F(a.price),total:F(a.total)}));return{hasPlan:!0,hasTrades:s.length>0,summaryText:n+o,trades:c}},Lr=(t,e)=>{const r=Pr(t.plan);if(!r.hasPlan)return i("p",{style:"color: var(--pico-muted-color);"},"No trade plan generated yet.");const s=i("p",{style:"font-size: 0.9rem; color: var(--pico-muted-color);"},r.summaryText);return r.hasTrades?i("div",[s,i("figure",[i("table",[i("thead",[i("tr",[i("th","Action"),i("th","Ticker"),i("th","Shares"),i("th","Price"),i("th","Total")])]),i("tbody",r.trades.map((n,o)=>i("tr",{key:o},[i("td",n.action),i("td",n.ticker),i("td",n.shares),i("td",n.price),i("td",n.total)])))])])]):i("div",[s,i("p",{style:"color: var(--pico-muted-color);"},"No trades required. Allocation is within tolerance.")])},ct={init:Ar,update:Rr,view:Lr},Or=f(()=>({model:{entries:[]},effects:[]})),Cr=(t,e,r)=>{switch(t.type){case"ADD_ENTRY":return{model:{...e,entries:[t.entry,...e.entries]},effects:[]};case"CLEAR":return{model:{...e,entries:[]},effects:[]};case"EXPORT_JSON":{const s=JSON.stringify(e.entries,null,2),n=f(()=>{const o=new Blob([s],{type:"application/json"}),c=URL.createObjectURL(o),a=document.createElement("a");a.href=c,a.download=`fp-rebalance-audit-${Date.now()}.json`,document.body.appendChild(a),a.click(),a.remove(),URL.revokeObjectURL(c)});return{model:e,effects:[n]}}default:return{model:e,effects:[]}}},Nr=(t,e)=>{const r=t.entries.map(s=>({summary:`[${s.timestamp}] ${s.operation} (${s.success?"ok":"error"})`,details:JSON.stringify(s.details,null,2)}));return{entries:r,hasEntries:r.length>0,exportJson:()=>e({type:"EXPORT_JSON"}),clear:()=>e({type:"CLEAR"})}},$r=(t,e)=>{const r=Nr(t,e);return i("div",[i("div",{style:"display:flex; gap:0.5rem; margin-bottom:0.5rem;"},[i("button",{onclick:r.exportJson,class:"secondary"},"Export JSON"),r.hasEntries?i("button",{onclick:r.clear,class:"secondary outline"},"Clear"):null]),r.hasEntries?i("div",{style:"max-height: 260px; overflow-y: auto; font-size: 0.8rem; border: 1px solid var(--pico-muted-border-color); border-radius: 0.5rem; padding: 0.5rem;"},r.entries.map((s,n)=>i("details",{key:n},[i("summary",s.summary),i("pre",s.details)]))):i("p",{style:"color: var(--pico-muted-color);"},"No audit entries yet.")])},Dr=$r,it={init:Or,update:Cr,view:Dr},Ir=f(()=>{const t=st.init.run(),e=nt.init.run(),r=ot.init.run(),s=ct.init.run(),n=it.init.run(),o={holdings:t.model,targets:e.model,drift:r.model,trades:s.model,audit:n.model},c=[...t.effects,...e.effects,...r.effects,...s.effects,...n.effects];return{model:o,effects:c}}),V=(t,e,r)=>(s,n,o)=>{const{model:c,effects:a}=t(s.msg,n[e],m=>o(r(m)));return{model:{...n,[e]:c},effects:a}},Mr=(t,e,r)=>{switch(t.type){case"Holdings":{const s=V(st.update,"holdings",c=>({type:"Holdings",msg:c}))(t,e,r),n=t.msg;if(n.type==="PRICE_FETCHED"||n.type==="ADD_HOLDING"||n.type==="REMOVE_HOLDING"){const c=f(()=>{const a=s.model.holdings.holdings,l=s.model.targets.target,[m]=Z(l).run(a);r({type:"Drift",msg:{type:"SET_REPORT",report:m}})});return{model:s.model,effects:[...s.effects,c]}}return s}case"Targets":{const s=V(nt.update,"targets",c=>({type:"Targets",msg:c}))(t,e,r),n=t.msg;if(n.type==="APPLY"||n.type==="RESET_DEFAULT"){const c=f(()=>{const a=s.model.holdings.holdings,l=s.model.targets.target,[m]=Z(l).run(a);r({type:"Drift",msg:{type:"SET_REPORT",report:m}})});return{model:s.model,effects:[...s.effects,c]}}return s}case"Drift":{const s=V(ot.update,"drift",o=>({type:"Drift",msg:o}))(t,e,r),n=t.msg;if(n.type==="SET_REPORT"){const o=n.report,c=f(()=>{const a=dr(o,e.holdings.holdings);r({type:"Trades",msg:{type:"SET_PLAN",plan:a}})});return{model:s.model,effects:[...s.effects,c]}}return s}case"Trades":return V(ct.update,"trades",s=>({type:"Trades",msg:s}))(t,e,r);case"Audit":return V(it.update,"audit",s=>({type:"Audit",msg:s}))(t,e,r);case"RECALCULATE_ALL":{const s=f(()=>{const n=e.holdings.holdings,o=e.targets.target,[c]=Z(o).run(n);r({type:"Drift",msg:{type:"SET_REPORT",report:c}})});return{model:e,effects:[s]}}default:return{model:e,effects:[]}}},Fr=(t,e)=>{const r=st.view(t.holdings,a=>e({type:"Holdings",msg:a})),s=nt.view(t.targets,a=>e({type:"Targets",msg:a})),n=ot.view(t.drift,a=>e({type:"Drift",msg:a})),o=ct.view(t.trades,a=>e({type:"Trades",msg:a})),c=it.view(t.audit,a=>e({type:"Audit",msg:a}));return[i("header",[i("h1","FPRebalance"),i("p","Mathematically Correct Portfolio Management")]),i("section",{id:"holdings"},r),i("section",{id:"targets"},s),i("section",{id:"drift"},n),i("section",{id:"trades"},o),i("section",{id:"audit"},c)]},xr={init:Ir,update:Mr,view:Fr},Hr=Je(),Br=f(()=>{const t=document.getElementById("app");if(!t)throw new Error("Root element #app not found");return t});Be(qe,Hr)(Br,xr).run();
