(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))r(o);new MutationObserver(o=>{for(const s of o)if(s.type==="childList")for(const c of s.addedNodes)c.tagName==="LINK"&&c.rel==="modulepreload"&&r(c)}).observe(document,{childList:!0,subtree:!0});function n(o){const s={};return o.integrity&&(s.integrity=o.integrity),o.referrerPolicy&&(s.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?s.credentials="include":o.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function r(o){if(o.ep)return;o.ep=!0;const s=n(o);fetch(o.href,s)}})();const ut=Symbol.for("fantasy-land/map"),lt=Symbol.for("fantasy-land/ap"),ft=Symbol.for("fantasy-land/chain"),k={map:ut,ap:lt,chain:ft},E=t=>({_tag:"IO",run:t,[k.map](n){return E(()=>n(t()))},[k.chain](n){return E(()=>n(t()).run())},[k.ap](n){return E(()=>this.run()(n.run()))}}),at=t=>E(t),M=t=>E(()=>t),A=t=>({_tag:"Reader",run:t,map(n){return A(r=>n(t(r)))},chain(n){return A(r=>n(t(r)).run(r))},ap(n){return A(r=>this.run(r)(n.run(r)))},[k.map](n){return this.map(n)},[k.chain](n){return this.chain(n)},[k.ap](n){return this.ap(n)}}),pt=t=>A(()=>t),dt=()=>A(t=>t),ht=t=>A(e=>t(e));Object.assign(t=>A(t),{of:pt,ask:dt,asks:ht});const w=t=>{const e={_tag:"Stream",subscribe:t,map(n){return w(r=>t(o=>r(n(o))))},filter(n){return w(r=>t(o=>{n(o)&&r(o)}))},scan(n,r){let o=r;return w(s=>(s(o),t(c=>{o=n(o,c),s(o)})))},[k.map](n){return e.map(n)}};return e},mt=Object.assign(t=>w(t),{new(){const t=new Set;return w(e=>(t.add(e),()=>t.delete(e)))},create(){const t=new Set;return[w(r=>(t.add(r),()=>t.delete(r))),r=>{t.forEach(o=>o(r))}]},fromArray(t){return w(e=>(t.forEach(e),()=>{}))},debounce(t){return e=>w(n=>{let r=null;const o=e.subscribe(s=>{r!==null&&clearTimeout(r),r=setTimeout(()=>{n(s),r=null},t)});return()=>{r!==null&&clearTimeout(r),o()}})}});mt.create;function yt(t){const e=t.length,n=new Array(e),r=[];for(let c=0;c<e;c++){const i=t[c];if(i<0){n[c]=-1;continue}let u=0,l=r.length;for(;u<l;){const d=u+l>>1;t[r[d]]<i?u=d+1:l=d}u===r.length?r.push(c):r[u]=c,n[c]=u>0?r[u-1]:-1}let o=r.length>0?r[r.length-1]:-1;const s=[];for(;o>=0;)s.push(o),o=n[o];return s.reverse(),s}function y(t,e,n,r,o,s){return{tag:t,key:e,attrs:n,children:r||[],text:o,dom:s}}y.normalize=function(e){if(Array.isArray(e)){const n=y.normalizeChildren(e);return n.length>0?n[0]:null}return e==null||typeof e=="boolean"?null:typeof e=="object"?e:y("#",null,null,[],String(e),null)};y.normalizeChildren=function(e){const n=e.length,r=new Array(n);let o=0,s=0,c=0;for(let i=0;i<n;i++){const u=e[i];if(Array.isArray(u)){const d=y.normalizeChildren(u),m=d.length;for(let g=0;g<m;g++){const S=d[g];r[o++]=S,S.tag!=="#"&&(c++,S.key!=null&&s++)}continue}const l=y.normalize(u);l!=null&&(r[o++]=l,l.tag!=="#"&&(c++,l.key!=null&&s++))}if(c>0&&s!==0&&s!==c)throw new TypeError("All element children must either all have keys or none.");return o===r.length?r:r.slice(0,o)};const V={}.hasOwnProperty,W={},B=/(^|#|\.)([^#\.]+)/g,v=Object.create(null),wt=t=>{for(const e in t)if(V.call(t,e))return!1;return!0};function gt(t){let e,n="div";const r=[];let o={};for(B.lastIndex=0;e=B.exec(t);){const c=e[1],i=e[2];c===""&&i!==""?n=i:c==="#"?o.id=i:c==="."&&r.push(i)}r.length&&(o.class=r.join(" ")),wt(o)&&(o=W);const s={tag:n,attrs:o};return v[t]=s,s}function bt(t,e){e.tag=t.tag;const n=e.attrs;if(n==null)return e.attrs=t.attrs,e;if(t.attrs!==W){const r={...t.attrs,...n};t.attrs.class!=null&&n.class!=null&&(r.class=t.attrs.class+" "+n.class),e.attrs=r}return e}function kt(t){return t!=null&&typeof t=="object"&&typeof t.tag=="string"&&"children"in t&&"attrs"in t}function p(t,...e){if(typeof t!="string")throw new Error("Selector must be a string");let n=null,r=0;if(e.length){const i=e[0];(i==null||typeof i=="object"&&!Array.isArray(i)&&!kt(i))&&(n=i,r=1)}const o=y.normalizeChildren(e.slice(r)),s=y("",n&&n.key,n||null,o,null,null),c=v[t]||gt(t);return bt(c,s)}const At="http://www.w3.org/2000/svg",St="http://www.w3.org/1998/Math/MathML";function K(t,e){const n=t.attrs;if(n&&n.xmlns)return n.xmlns;const r=t.tag;return r==="svg"?At:r==="math"?St:e}const F={div:[],span:[],li:[],ul:[],p:[]};function Et(t,e){const n=F[t];if(n&&n.length>0){const r=n.pop();return r.innerHTML="",r}return e.createElement(t)}function xt(t,e){const n=t.dom;if(!n)return;n.parentNode===e&&e.removeChild(n);const r=t.tag,o=F[r];o&&o.push(n)}function N(t,e,n,r,o,s,c){for(let i=n;i<r;i++){const u=e[i];$(t,u,o,s,c)}}function $(t,e,n,r,o){if(e.tag==="#"){const s=e.dom=o.createTextNode(e.text||"");L(t,s,n)}else Ot(t,e,r,n,o)}function Ot(t,e,n,r,o){const s=e.tag,c=e.attrs,i=K(e,n),u=i?o.createElementNS(i,s):Et(s,o);e.dom=u,c!=null&&Nt(e,c),L(t,u,r);const l=e.children;l!=null&&l.length>0&&N(u,l,0,l.length,null,i,o)}function H(t,e,n,r,o,s){const c=e||[],i=n||[];if(c===i)return;const u=c.length,l=i.length;if(u===0){l>0&&N(t,i,0,l,r,o,s);return}if(l===0){I(t,c,0,u);return}const d=c[0]!=null&&c[0].key!=null,m=i[0]!=null&&i[0].key!=null;if(d!==m){I(t,c,0,u),N(t,i,0,l,r,o,s);return}if(!m){const f=u<l?u:l;for(let a=0;a<f;a++){const b=c[a],h=i[a];if(b===h)continue;const C=Ct(c,a+1,r);R(t,b,h,C,o,s)}u>f&&I(t,c,f,u),l>f&&N(t,i,f,l,r,o,s);return}const g=new Map;for(let f=0;f<u;f++){const a=c[f];a!=null&&a.key!=null&&g.set(a.key,f)}const S=new Set,x=new Int32Array(l);x.fill(-1);for(let f=0;f<l;f++){const a=i[f],b=a!=null?a.key:null,h=b!=null?g.get(b)??-1:-1;if(x[f]=h,h>=0){const C=c[h];S.add(h),C!==a&&R(t,C,a,null,o,s)}}for(let f=0;f<u;f++)S.has(f)||_(t,c[f]);const ct=yt(Array.from(x)),it=new Set(ct);let O=r;for(let f=l-1;f>=0;f--){const a=i[f];if(!a)continue;const b=x[f];let h=a.dom;b<0?($(t,a,O,o,s),h=a.dom):!it.has(f)&&h&&h.nextSibling!==O&&L(t,h,O),O=h}}function R(t,e,n,r,o,s){if(e!==n){if(e.tag==="#"&&n.tag==="#"){n.dom=e.dom;const c=e.dom;c&&e.text!==n.text&&(c.nodeValue=n.text??"");return}if(e.tag===n.tag){const c=e.dom;n.dom=c;const i=e.children,u=n.children;if(i.length===0&&u.length===0&&n.text!=null&&e.tag!=="#"){const d=c,m=d&&d.firstChild;(m&&m.nodeValue||"")!==n.text&&(d.textContent=n.text);return}const l=K(n,o);e.attrs!==n.attrs&&It(n,e.attrs,n.attrs),H(c,i,u,null,l,s);return}_(t,e),$(t,n,r,o,s)}}function L(t,e,n){n?t.insertBefore(e,n):t.appendChild(e)}function I(t,e,n,r){for(let o=n;o<r;o++){const s=e[o];_(t,s)}}function _(t,e){xt(e,t)}function Ct(t,e,n){const r=t.length;for(;e<r;e++){const o=t[e];if(o&&o.dom)return o.dom}return n}function Nt(t,e,n){for(const r in e)V.call(e,r)&&G(t,r,null,e[r])}function G(t,e,n,r,o){if(e==="key")return;const s=t.dom;if(e.slice(0,2)==="on"){s[e]=typeof r=="function"?r:null;return}if(r==null){J(t,e,n);return}if(e==="value"){s.value!==r&&(s.value=r);return}if(e==="checked"){const c=!!r;s.checked!==c&&(s.checked=c);return}if(e==="selected"){const c=!!r;s.selected!==c&&(s.selected=c);return}if(e==="style"){Q(s,n,r);return}if(e==="class"){s.className=r;return}if(typeof r=="boolean"){r?s.setAttribute(e,""):s.removeAttribute(e);return}s.setAttribute(e,String(r))}function J(t,e,n,r){const o=t.dom;if(e.slice(0,2)==="on"){o[e]=null;return}if(e==="style"){Q(o,n,null);return}if(e==="class"){o.removeAttribute("class");return}o.removeAttribute(e)}function It(t,e,n,r){if(e)for(const o in e){const s=e[o];s!=null&&(!n||n[o]==null)&&J(t,o,s)}if(n)for(const o in n){const s=n[o],c=e&&e[o];s!==c&&G(t,o,c,s)}}function Q(t,e,n){if(n==null){t.removeAttribute("style");return}if(typeof n=="string"){t.setAttribute("style",n);return}t.removeAttribute("style");for(const r in n){const o=n[r];o!=null&&(r.indexOf("-")!==-1?t.style.setProperty(r,String(o)):t.style[r]=String(o))}}function Tt(t,e){if(!t)throw new TypeError("Root DOM is null");const n=t.namespaceURI,r=t.vnodes;r==null&&(t.textContent="");const o=y.normalizeChildren(Array.isArray(e)?e:[e]),s=t.ownerDocument;H(t,r,o,null,n==="http://www.w3.org/1999/xhtml"?void 0:n??void 0,s),t.vnodes=o}const X=Symbol("EffectBrand"),z=t=>({[X]:!0,run:t}),jt=(t,e)=>({_tag:"Subscription",key:t,effect:z(e)}),Y=t=>!!t&&typeof t=="object"&&t._tag==="Subscription",Z=t=>!!t&&typeof t=="object"&&t[X]===!0,U=t=>!!t&&typeof t=="object"&&typeof t.run=="function"&&typeof t.runWith=="function",Mt=t=>!!t&&typeof t=="object"&&typeof t.run=="function"&&t.run.length>=1&&typeof t.runWith!="function",j=t=>!!t&&typeof t=="object"&&typeof t.run=="function"&&t.run.length===0&&typeof t.runWith!="function";function q(t,e,n){const r=typeof e=="function"?e:n,o=typeof e=="function"?n:e,s=[];if(o&&o.length>0){for(const c of o)if(c&&!Y(c)){if(Z(c)){const i=c.run(t,r);typeof i=="function"&&s.push(i);continue}if(U(c)){c.run().then(i=>{i&&i._tag==="Right"&&i.right!==void 0&&r(i.right)});continue}if(Mt(c)){const i=c.run(t);if(j(i)){const u=i.run();u!==void 0&&r(u);continue}if(U(i)){i.run().then(u=>{u&&u._tag==="Right"&&u.right!==void 0&&r(u.right)});continue}continue}if(j(c)){const i=c.run();i!==void 0&&r(i);continue}r(c)}}return()=>{for(const c of s)try{c()}catch{}}}const T=(t,e)=>{if(Y(t))throw new Error("mapCmd: Subscription is not a Cmd. Use mapSub/mapSubs.");if(typeof t=="object"&&t!==null&&"type"in t)return e(t);if(j(t)){const n=t;return{...n,run:()=>{const r=n.run();return r===void 0?void 0:e(r)}}}if(Z(t)){const n=t;return z((r,o)=>n.run(r,s=>o(e(s))))}return t},D=(t,e,n,r)=>{const o=new Map;for(const s of n){const c=r.get(s.key);if(c){o.set(s.key,c);continue}const i=s.effect.run(t,e);typeof i=="function"&&o.set(s.key,i)}for(const[s,c]of r)o.has(s)||c();r.clear();for(const[s,c]of o)r.set(s,c)},$t=(t,e,n,r)=>{if(!t)throw new TypeError("renderApp: root element is required");if(!e)throw new TypeError("renderApp: program is required");if(!r)throw new TypeError("renderApp: renderer is required");if(!e.init||typeof e.init.run!="function")throw new TypeError("renderApp: program.init must be an IO");if(!e.update||typeof e.update!="function")throw new TypeError("renderApp: program.update must be a function");if(!e.view||typeof e.view!="function")throw new TypeError("renderApp: program.view must be a function");let o;const s=new Map,c=()=>{r(t,e.view(o,u))},i=()=>e.subs?e.subs(o):[],u=d=>{const m=e.update(d,o,u);o=m.model,c(),D(n,u,i(),s),q(n,u,m.effects)},l=e.init.run();o=l.model,c(),D(n,u,i(),s),q(n,u,l.effects)},Lt=M({model:{count:0},effects:[]}),_t=(t,e)=>{switch(t.type){case"counter.increment":return{model:{count:e.count+1},effects:[]};case"counter.decrement":return{model:{count:e.count-1},effects:[]};default:return{model:e,effects:[]}}},tt=(t,e)=>p("section.card",[p("h2","Counter"),p("div",t.count),p("button",{onclick:()=>e({type:"counter.increment"})},"+"),p("button",{onclick:()=>e({type:"counter.decrement"})},"-")]),et={init:Lt,update:_t,view:tt},zt=M({model:{running:!1,nowMs:0},effects:[]}),Pt=()=>jt("clock",(t,e)=>{const n=t.window.setInterval(()=>{e({type:"clock.tick",ms:t.now()})},250);return()=>t.window.clearInterval(n)}),Bt=(t,e)=>{switch(console.log(t),t.type){case"clock.start":return{model:{...e,running:!0},effects:[]};case"clock.stop":return{model:{...e,running:!1},effects:[]};case"clock.tick":return{model:{...e,nowMs:t.ms},effects:[]};default:return{model:e,effects:[]}}},Rt=t=>t.running?[Pt()]:[],nt=(t,e)=>p("section.card",[p("h2","Clock"),p("div",`now(ms): ${t.nowMs}`),p("button",{onclick:()=>e({type:"clock.start"})},"Start"),p("button",{onclick:()=>e({type:"clock.stop"})},"Stop")]),P={init:zt,update:Bt,view:nt,subs:Rt},Ut=M({model:{users:[],loading:!1,error:null},effects:[]}),qt=()=>z((t,e)=>{t.fetch(`${t.usersBaseUrl}/users`).then(n=>n.json()).then(n=>e({type:"users.loaded",users:n}),n=>e({type:"users.failed",error:String(n)}))}),Dt=(t,e)=>{switch(t.type){case"users.fetch":return{model:{...e,loading:!0,error:null},effects:[qt()]};case"users.loaded":return{model:{users:t.users,loading:!1,error:null},effects:[]};case"users.failed":return{model:{...e,loading:!1,error:t.error},effects:[]};default:return{model:e,effects:[]}}},rt=(t,e)=>p("section.card",[p("h2","Users"),p("button",{onclick:()=>e({type:"users.fetch"})},"Load users"),t.loading&&p("div","Loadingâ€¦"),t.error&&p("div.error",t.error),p("ul",t.users.map(n=>p("li",`${n.name} (${n.email})`)))]),ot={init:Ut,update:Dt,view:rt},Vt=at(()=>{const t=et.init.run(),e=P.init.run(),n=ot.init.run();return{model:{counter:t.model,clock:e.model,users:n.model},effects:[...t.effects,...e.effects,...n.effects]}}),Wt=(t,e,n)=>{if(t.type.startsWith("counter.")){const r=et.update(t,e.counter,n);return{model:{...e,counter:r.model},effects:r.effects.map(o=>T(o,s=>s))}}if(t.type.startsWith("clock.")){const r=P.update(t,e.clock,n);return{model:{...e,clock:r.model},effects:r.effects.map(o=>T(o,s=>s))}}if(t.type.startsWith("users.")){const r=ot.update(t,e.users,n);return{model:{...e,users:r.model},effects:r.effects.map(o=>T(o,s=>s))}}return{model:e,effects:[]}},vt=(t,e)=>p("div.app",[tt(t.counter,e),nt(t.clock,e),rt(t.users,e)]),Kt=t=>[...P.subs(t.clock)],Ft={init:Vt,update:Wt,view:vt,subs:Kt},Ht=()=>{const t=window;return{window:t,storage:t.localStorage,fetch:window.fetch.bind(window),now:()=>Date.now(),usersBaseUrl:"https://jsonplaceholder.typicode.com",quotesBaseUrl:"https://api.coingecko.com/api/v3"}},st=document.getElementById("app");if(!st)throw new Error("#app not found");const Gt=Ht(),Jt=(t,e)=>{Tt(t,e)};$t(st,Ft,Gt,Jt);
