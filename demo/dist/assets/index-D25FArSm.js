(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))n(s);new MutationObserver(s=>{for(const o of s)if(o.type==="childList")for(const c of o.addedNodes)c.tagName==="LINK"&&c.rel==="modulepreload"&&n(c)}).observe(document,{childList:!0,subtree:!0});function r(s){const o={};return s.integrity&&(o.integrity=s.integrity),s.referrerPolicy&&(o.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?o.credentials="include":s.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function n(s){if(s.ep)return;s.ep=!0;const o=r(s);fetch(s.href,o)}})();const Nt=Symbol("IOBrand"),f=t=>({[Nt]:!0,run:t,map:e=>f(()=>e(t())),chain:e=>f(()=>e(t()).run()),ap:e=>f(()=>e.run()(t()))});f.of=t=>f(()=>t);f.map=t=>e=>e.map(t);f.chain=t=>e=>e.chain(t);f.ap=t=>e=>e.ap(t);f.run=t=>t.run();f.sequence=t=>f(()=>t.map(e=>e.run()));f.traverse=t=>e=>f(()=>e.map(r=>t(r).run()));f.tryCatch=(t,e)=>f(()=>{try{return t()}catch(r){return e(r)}});const gt=Symbol("EitherBrand"),w=t=>({_tag:"Left",left:t,[gt]:!0}),y=t=>({_tag:"Right",right:t,[gt]:!0}),Ot=(t,e)=>e._tag==="Right"?y(t(e.right)):e,$t=(t,e)=>t._tag==="Left"?w(t.left):e._tag==="Left"?w(e.left):y(t.right(e.right)),Pt=(t,e)=>e._tag==="Right"?t(e.right):e,Ct=(t,e,r)=>r._tag==="Left"?w(t(r.left)):y(e(r.right)),It=(t,e)=>e._tag==="Left"?w(t(e.left)):e,Dt=(t,e,r)=>r._tag==="Left"?t(r.left):e(r.right),Ft=t=>y(t),Ht=(t,e)=>e._tag==="Right"?e.right:t,Mt=(t,e)=>e._tag==="Right"?e.right:t(e.left),xt=(t,e)=>t._tag==="Right"?t:e,Jt=t=>t._tag==="Left",Bt=t=>t._tag==="Right",Vt=t=>e=>e==null?w(t):y(e),Ut=t=>{try{return y(t())}catch(e){return w(e)}},qt=(t,e)=>{try{return y(t())}catch(r){return w(e(r))}},Gt=t=>t._tag==="Left"?y(t.left):w(t.right),Wt=(t,e,r)=>r._tag==="Right"&&!t(r.right)?w(e(r.right)):r,pt=(t,e)=>{const r=[];for(const n of e){const s=t(n);if(s._tag==="Left")return s;r.push(s.right)}return y(r)},Kt=t=>pt(e=>e,t),A={Left:w,Right:y,map:Ot,ap:$t,chain:Pt,bimap:Ct,mapLeft:It,fold:Dt,of:Ft,getOrElse:Ht,getOrElseW:Mt,alt:xt,isLeft:Jt,isRight:Bt,fromNullable:Vt,tryCatch:Ut,tryCatchK:qt,swap:Gt,filterOrElse:Wt,traverse:pt,sequence:Kt},ht=Symbol("MaybeBrand"),M=t=>({_tag:"Just",value:t,[ht]:!0}),F={_tag:"Nothing",[ht]:!0},zt=(t,e)=>e._tag==="Just"?M(t(e.value)):F,jt=(t,e)=>t._tag==="Just"&&e._tag==="Just"?M(t.value(e.value)):F,Yt=(t,e)=>e._tag==="Just"?t(e.value):F,Qt=t=>M(t),Xt=(t,e,r)=>r._tag==="Nothing"?t():e(r.value),Zt=(t,e)=>e._tag==="Just"?e.value:t,te=(t,e)=>e._tag==="Just"?e.value:t(),ee=(t,e)=>t._tag==="Just"?t:e,re=t=>t==null?F:M(t),ne=t=>t._tag==="Just"?t.value:null,se=t=>t._tag==="Just"?t.value:void 0,oe=t=>t._tag==="Just",ce=t=>t._tag==="Nothing",ie=(t,e)=>e._tag==="Just"&&t(e.value)?e:F,mt=(t,e)=>{const r=[];for(const n of e){const s=t(n);if(s._tag==="Nothing")return F;r.push(s.value)}return M(r)},ae=t=>mt(e=>e,t),v={Just:M,Nothing:F,map:zt,ap:jt,chain:Yt,of:Qt,fold:Xt,getOrElse:Zt,getOrElseW:te,alt:ee,fromNullable:re,toNullable:ne,toUndefined:se,isJust:oe,isNothing:ce,filter:ie,traverse:mt,sequence:ae},le=Symbol("ReaderBrand"),p=t=>({[le]:!0,run:t,map:e=>p(r=>e(t(r))),chain:e=>p(r=>e(t(r)).run(r)),ap:e=>p(r=>e.run(r)(t(r)))});p.of=t=>p(()=>t);p.ask=()=>p(t=>t);p.asks=t=>p(t);p.map=t=>e=>e.map(t);p.chain=t=>e=>e.chain(t);p.ap=t=>e=>e.ap(t);p.run=t=>e=>e.run(t);p.local=t=>e=>p(r=>e.run(t(r)));p.sequence=t=>p(e=>t.map(r=>r.run(e)));p.traverse=t=>e=>p(r=>e.map(n=>t(n).run(r)));const ue=Symbol("StateBrand"),g=t=>({[ue]:!0,run:t,map:e=>g(r=>{const[n,s]=t(r);return[e(n),s]}),chain:e=>g(r=>{const[n,s]=t(r);return e(n).run(s)}),ap:e=>g(r=>{const[n,s]=e.run(r),[o,c]=t(s);return[n(o),c]})});g.of=t=>g(e=>[t,e]);g.get=()=>g(t=>[t,t]);g.put=t=>g(()=>[void 0,t]);g.modify=t=>g(e=>[void 0,t(e)]);g.gets=t=>g(e=>[t(e),e]);g.map=t=>e=>e.map(t);g.chain=t=>e=>e.chain(t);g.ap=t=>e=>e.ap(t);g.run=t=>e=>e.run(t);g.evalState=t=>e=>e.run(t)[0];g.execState=t=>e=>e.run(t)[1];g.sequence=t=>g(e=>{let r=e;const n=[];for(const s of t){const[o,c]=s.run(r);n.push(o),r=c}return[n,r]});g.traverse=t=>e=>g.sequence(e.map(t));const fe=Symbol("TaskBrand"),u=t=>({[fe]:!0,run:()=>t(),runWith:e=>{if(!e)throw new Error("Task.runWith requires an AbortSignal. Use run() if cancellation is not needed.");return t(e)},map:e=>u(r=>t(r).then(n=>n._tag==="Right"?y(e(n.right)):n)),chain:e=>u(r=>t(r).then(n=>n._tag==="Right"?e(n.right).runWith(r):Promise.resolve(n))),ap:e=>u(r=>e.runWith(r).then(n=>n._tag==="Right"?t(r).then(s=>s._tag==="Right"?y(n.right(s.right)):s):Promise.resolve(n))),mapError:e=>u(r=>t(r).then(n=>n._tag==="Left"?w(e(n.left)):n)),bimap:(e,r)=>u(n=>t(n).then(s=>s._tag==="Left"?w(e(s.left)):y(r(s.right))))});u.of=t=>u(()=>Promise.resolve(y(t)));u.reject=t=>u(()=>Promise.resolve(w(t)));u.tryCatch=t=>u(()=>t().then(y).catch(w));u.tryCatchK=(t,e)=>u(()=>t().then(y).catch(r=>w(e(r))));u.map=t=>e=>e.map(t);u.chain=t=>e=>e.chain(t);u.ap=t=>e=>e.ap(t);u.mapError=t=>e=>e.mapError(t);u.bimap=(t,e)=>r=>r.bimap(t,e);u.fold=(t,e)=>r=>r.run().then(n=>n._tag==="Left"?t(n.left):e(n.right));u.getOrElse=t=>e=>e.run().then(r=>r._tag==="Right"?r.right:t);u.delay=t=>e=>u(r=>new Promise(n=>{const s=setTimeout(()=>{e.runWith(r).then(n)},t);r&&r.addEventListener("abort",()=>{clearTimeout(s),n(w({message:"Task.delay aborted"}))},{once:!0})}));u.timeout=(t,e)=>r=>u(n=>new Promise(s=>{const o=setTimeout(()=>s(w(e)),t),c=r.runWith(n).then(a=>{clearTimeout(o),s(a)});return n&&n.addEventListener("abort",()=>{clearTimeout(o)}),c}));u.sequence=t=>u(e=>(async()=>{const r=[];for(const n of t){const s=await n.runWith(e);if(s._tag==="Left")return s;r.push(s.right)}return y(r)})());u.traverse=t=>e=>u.sequence(e.map(t));u.all=t=>u(e=>Promise.all(t.map(r=>r.runWith(e))).then(r=>{const n=[];for(const s of r){if(s._tag==="Left")return s;n.push(s.right)}return y(n)}));u.race=t=>u(e=>Promise.race(t.map(r=>r.runWith(e))));u.fromEither=t=>u(()=>Promise.resolve(t));u.toPromise=t=>t.run().then(e=>{if(e._tag==="Left")throw e.left;return e.right});const yt=Symbol("ValidationBrand"),$=t=>({_tag:"Failure",errors:t,[yt]:!0}),P=t=>({_tag:"Success",value:t,[yt]:!0}),de=(t,e)=>e._tag==="Success"?P(t(e.value)):e,ge=(t,e)=>t._tag==="Failure"&&e._tag==="Failure"?$([...t.errors,...e.errors]):t._tag==="Failure"?t:e._tag==="Failure"?e:P(t.value(e.value)),pe=(t,e)=>e._tag==="Success"?t(e.value):e,he=(t,e,r)=>r._tag==="Failure"?$(t(r.errors)):P(e(r.value)),me=(t,e)=>e._tag==="Failure"?$(t(e.errors)):e,ye=t=>P(t),Ee=(t,e,r)=>r._tag==="Failure"?t(r.errors):e(r.value),we=(t,e)=>e._tag==="Success"?e.value:t,ve=(t,e)=>e._tag==="Success"?e.value:t(e.errors),Se=t=>t._tag==="Failure",be=t=>t._tag==="Success",Et=t=>$([t]),_e=(t,e)=>t._tag==="Success"?t:e._tag==="Success"?e:$([...t.errors,...e.errors]),Re=t=>{const e=[],r=[];for(const n of t)n._tag==="Success"?e.push(n.value):r.push(...n.errors);return r.length>0?$(r):P(e)},wt=(t,e)=>{const r=[],n=[];for(const s of e){const o=t(s);o._tag==="Success"?r.push(o.value):n.push(...o.errors)}return n.length>0?$(n):P(r)},ke=t=>wt(e=>e,t),Ae=(t,e)=>r=>t(r)?P(r):Et(e(r)),D={Failure:$,Success:P,map:de,ap:ge,chain:pe,bimap:he,mapErrors:me,of:ye,fold:Ee,getOrElse:we,getOrElseW:ve,isFailure:Se,isSuccess:be,fail:Et,alt:_e,combine:Re,traverse:wt,sequence:ke,fromPredicate:Ae};function Te(t){const e=t.length,r=new Array(e),n=[];for(let c=0;c<e;c++){const a=t[c];if(a<0){r[c]=-1;continue}let l=0,h=n.length;for(;l<h;){const b=l+h>>1;t[n[b]]<a?l=b+1:h=b}l===n.length?n.push(c):n[l]=c,r[c]=l>0?n[l-1]:-1}let s=n.length>0?n[n.length-1]:-1;const o=[];for(;s>=0;)o.push(s),s=r[s];return o.reverse(),o}function N(t,e,r,n,s,o){return{tag:t,key:e,attrs:r,children:n||[],text:s,dom:o}}N.normalize=function(t){if(Array.isArray(t)){const e=N.normalizeChildren(t);return e.length>0?e[0]:null}return t==null||typeof t=="boolean"?null:typeof t=="object"?t:N("#",null,null,[],String(t),null)};N.normalizeChildren=function(t){const e=[];let r=0,n=0;for(let s=0;s<t.length;s++){const o=t[s];if(Array.isArray(o)){const a=N.normalizeChildren(o);for(let l=0;l<a.length;l++){const h=a[l];e.push(h),h.tag!=="#"&&(n++,h.key!=null&&r++)}continue}const c=N.normalize(o);c!=null&&(e.push(c),c.tag!=="#"&&(n++,c.key!=null&&r++))}if(n>0&&r!==0&&r!==n)throw new TypeError("All element children must either all have keys or none.");return e};const vt={}.hasOwnProperty,St={},Le=/(^|#|\.)([^#\.]+)/g,G=Object.create(null),Ne=1e3;let j=0;const Oe=t=>{for(const e in t)if(vt.call(t,e))return!1;return!0};function $e(t){let e,r="div";const n=[];let s={};for(;e=Le.exec(t);){const c=e[1],a=e[2];c===""&&a!==""?r=a:c==="#"?s.id=a:c==="."&&n.push(a)}n.length&&(s.class=n.join(" ")),Oe(s)&&(s=St);const o={tag:r,attrs:s};if(j>=Ne){const c=Object.keys(G),a=Math.floor(c.length/2);for(let l=0;l<a;l++)delete G[c[l]];j-=a}return G[t]=o,j++,o}function Pe(t,e){e.tag=t.tag;let r=e.attrs;if(r==null)return e.attrs=t.attrs,e;if(t.attrs!==St){const n={...t.attrs,...r};t.attrs.class!=null&&r.class!=null&&(n.class=t.attrs.class+" "+r.class),e.attrs=n}return e}function i(t,...e){if(typeof t!="string")throw new Error("Selector must be a string");let r=null,n=0;function s(l){return l!=null&&typeof l=="object"&&typeof l.tag=="string"&&"children"in l&&"attrs"in l}if(e.length){const l=e[0];(l==null||typeof l=="object"&&!Array.isArray(l)&&!s(l))&&(r=l,n=1)}const o=N.normalizeChildren(e.slice(n)),c=N("",r&&r.key,r||null,o,null,null),a=G[t]||$e(t);return Pe(a,c)}const Ce={svg:"http://www.w3.org/2000/svg",math:"http://www.w3.org/1998/Math/MathML"};function Ie(t){return t.attrs&&t.attrs.xmlns||Ce[t.tag]}function W(t,e,r,n,s,o){for(let c=r;c<n;c++){const a=e[c];K(t,a,s,o)}}function K(t,e,r,n){if(e.tag==="#"){const s=t.ownerDocument;if(!s)throw new Error("Parent node has no ownerDocument");const o=e.dom=s.createTextNode(e.text||"");nt(t,o,r)}else De(t,e,n,r)}function De(t,e,r,n){const s=e.tag,o=e.attrs;r=Ie(e)||r;const c=t.ownerDocument,a=r!=null?c.createElementNS(r,s):c.createElement(s);e.dom=a,o!=null&&He(e,o),nt(t,a,n);const l=e.children;l!=null&&W(a,l,0,l.length,null,r)}function bt(t,e,r,n,s){const o=e||[],c=r||[];if(o===c)return;const a=o.length,l=c.length;if(a===0){l>0&&W(t,c,0,l,n,s);return}if(l===0){Y(t,o,0,a);return}const h=o[0]!=null&&o[0].key!=null,b=c[0]!=null&&c[0].key!=null;if(h!==b){Y(t,o,0,a),W(t,c,0,l,n,s);return}if(!b){const d=Math.min(a,l);for(let m=0;m<d;m++){const C=o[m],S=c[m];if(C===S)continue;const q=Fe(o,m+1,n);ut(t,C,S,q,s)}a>d&&Y(t,o,d,a),l>d&&W(t,c,d,l,n,s);return}const x=new Map;for(let d=0;d<a;d++){const m=o[d];m!=null&&m.key!=null&&x.set(m.key,d)}const T=new Set,R=new Array(l);for(let d=0;d<l;d++)R[d]=-1;for(let d=0;d<l;d++){const m=c[d],C=m!=null?m.key:null,S=C!=null?x.get(C)??-1:-1;if(R[d]=S,S>=0){const q=o[S];T.add(S),q!==m&&ut(t,q,m,null,s)}}for(let d=0;d<a;d++)T.has(d)||z(t,o[d]);const _=R,E=Te(_),k=new Set(E);let L=n;for(let d=l-1;d>=0;d--){const m=c[d];if(!m)continue;const C=_[d];let S=m.dom;C<0?(K(t,m,L,s),S=m.dom):!k.has(d)&&S&&S.nextSibling!==L&&nt(t,S,L),L=S}}function ut(t,e,r,n,s){if(e!==r)if(e.tag===r.tag){const o=s,c=r.tag==="svg"?"http://www.w3.org/2000/svg":s;if(o!==c){K(t,r,n,c),z(t,e);return}r.dom=e.dom,e.attrs!==r.attrs&&Me(r,e.attrs,r.attrs),bt(r.dom,e.children,r.children,null,c);return}else z(t,e),K(t,r,n,s)}function nt(t,e,r){r?t.insertBefore(e,r):t.appendChild(e)}function Y(t,e,r,n){for(let s=r;s<n;s++){const o=e[s];z(t,o)}}function z(t,e){const r=e.dom;r&&r.parentNode===t&&t.removeChild(r)}function Fe(t,e,r){for(;e<t.length;e++){const n=t[e];if(n&&n.dom)return n.dom}return r}function He(t,e,r){for(const n in e)vt.call(e,n)&&_t(t,n,null,e[n])}function _t(t,e,r,n,s){if(e==="key")return;const o=t.dom;if(e.startsWith("on")){o[e]=typeof n=="function"?n:null;return}if(n==null){Rt(t,e,r);return}if(e==="style"){kt(o,r,n);return}if(e==="class"){o.setAttribute("class",n);return}if(typeof n=="boolean"){n?o.setAttribute(e,""):o.removeAttribute(e);return}o.setAttribute(e,String(n))}function Rt(t,e,r,n){const s=t.dom;if(e.startsWith("on")){s[e]=null;return}if(e==="style"){kt(s,r,null);return}if(e==="class"){s.removeAttribute("class");return}s.removeAttribute(e)}function Me(t,e,r,n){if(e)for(const s in e){const o=e[s];o!=null&&(!r||r[s]==null)&&Rt(t,s,o)}if(r)for(const s in r){const o=r[s],c=e&&e[s];o!==c&&_t(t,s,c,o)}}function kt(t,e,r){if(r==null){t.removeAttribute("style");return}if(typeof r=="string"){t.setAttribute("style",r);return}t.removeAttribute("style");for(const n in r){const s=r[n];s!=null&&(n.includes("-")?t.style.setProperty(n,String(s)):t.style[n]=String(s))}}function xe(t,e){if(!t)throw new TypeError("Root DOM is null");const r=t.namespaceURI,n=t.vnodes;n==null&&(t.textContent="");const s=N.normalizeChildren(Array.isArray(e)?e:[e]);bt(t,n,s,null,r==="http://www.w3.org/1999/xhtml"?void 0:r??void 0),t.vnodes=s}const Je=Symbol("IOEffect"),Be=Symbol("ReaderEffect"),B=p(t=>t);B.map(t=>t.document);B.map(t=>t.window);B.map(t=>t.localStorage);B.map(t=>t.sessionStorage);B.map(t=>t.fetch);const At=()=>{if(typeof window>"u"||typeof document>"u")throw new Error("browserEnv() called in a non-browser environment. Use a custom DomEnv implementation when running SSR or tests.");return{document:window.document,window,localStorage:window.localStorage,sessionStorage:window.sessionStorage,fetch:window.fetch.bind(window)}},Ve=(t,e=At())=>(r,n)=>r.map(s=>{let o;const c=[];let a=!1,l=!1;const h=_=>{_?.forEach(E=>{if(E){if(E._tag===Je){E.io.run();return}if(E._tag===Be){E.reader.run(e).run();return}if(typeof E.run=="function"){const k=E;if(k.run.length>=1){const L=k.run(e);L&&typeof L.run=="function"&&L.run();return}k.run()}}})},b=(_,E)=>{t(s,n.view(_,T)),h(E)},x=_=>{if(o===void 0||l)return;const{model:E,effects:k}=n.update(_,o,T);o=E,b(o,k)},T=_=>{l||(c.push(_),a||(a=!0,requestAnimationFrame(()=>{if(l)return;const E=c.splice(0,c.length);a=!1;for(const k of E)x(k)})))},R=()=>{const{model:_,effects:E}=n.init.run();o=_,b(o,E)};return f(()=>(R(),{dispatch:T,getModel:()=>o,destroy:()=>{l=!0,c.length=0,a=!0}}))}).chain(s=>s),V=p(t=>t);V.map(t=>t.document);V.map(t=>t.window);V.map(t=>t.localStorage);V.map(t=>t.sessionStorage);V.map(t=>t.fetch);const Ue=(t,e)=>{xe(t,e)},qe=f(()=>({model:{holdings:[],input:{ticker:"",shares:""},validationErrors:[],fetchingPrices:new Set,priceErrors:new Map},effects:[]})),H=(t,e)=>D.Failure([{field:t,message:e}]),st=t=>D.Success(t),Ge=t=>{const e=t.trim().toUpperCase();return e.length===0?H("ticker","Ticker is required"):/^[A-Z]{1,5}$/.test(e)?st(e):H("ticker","Ticker must be 1â€“5 uppercase letters")},We=t=>{const e=t.trim();if(!e)return H("shares","Shares required");const r=Number(e);return Number.isFinite(r)?r<=0?H("shares","Shares must be > 0"):st(r):H("shares","Shares must be numeric")},Ke=(t,e)=>{const r=Ge(t),n=We(e),s=o=>c=>({ticker:o,shares:c});return D.ap(D.ap(D.Success(s),r),n)},ze=(t,e)=>e.some(r=>r.ticker===t)?H("ticker",`Ticker ${t} already exists`):st(null),je=(t,e,r)=>{const n=[];t<0&&n.push({field:"stocks",message:"Cannot be negative"}),e<0&&n.push({field:"bonds",message:"Cannot be negative"}),r<0&&n.push({field:"cash",message:"Cannot be negative"});const s=t+e+r;return s!==100&&n.push({field:"allocation",message:`Allocation must sum to 100%, got ${s}%`}),n.length>0?D.Failure(n):D.Success({stocks:t,bonds:e,cash:r})},U={HOLDINGS:"fp-rebalance:holdings",TARGET:"fp-rebalance:target",PRICES_CACHE:"fp-rebalance:prices-cache"},Q=t=>f(()=>{try{localStorage.setItem(U.HOLDINGS,JSON.stringify(t))}catch(e){console.error("[Storage] Failed to save holdings:",e)}}),ft=t=>f(()=>{try{localStorage.setItem(U.TARGET,JSON.stringify(t))}catch(e){console.error("[Storage] Failed to save target:",e)}}),Ye=()=>f(()=>{try{const t=localStorage.getItem(U.TARGET);if(!t)return v.Nothing;const e=JSON.parse(t);return v.Just(e)}catch(t){return console.error("[Storage] Failed to load target:",t),v.Nothing}}),Tt=()=>f(()=>{try{const t=localStorage.getItem(U.PRICES_CACHE);return t?JSON.parse(t):{}}catch(t){return console.error("[Storage] Failed to load price cache:",t),{}}}),Qe=(t,e)=>f(()=>{try{const n={...Tt().run(),[t]:{price:e,timestamp:Date.now()}};localStorage.setItem(U.PRICES_CACHE,JSON.stringify(n))}catch(r){console.error("[Storage] Failed to cache price:",r)}}),Xe=t=>f(()=>{try{const r=Tt().run()[t];if(!r)return v.Nothing;const n=Date.now(),s=5*60*1e3;return n-r.timestamp>s?v.Nothing:v.Just(r.price)}catch(e){return console.error("[Storage] Failed to get cached price:",e),v.Nothing}});let X=0,Z=Date.now();const Ze=()=>{const t=Date.now(),e=60*1e3;if(t-Z>e&&(X=0,Z=t),X>=5){const r=60-Math.floor((t-Z)/1e3);return A.Left({type:"rateLimit",retryAfter:r>0?r:1})}return X+=1,A.Right(void 0)},tr=t=>p(e=>u(async r=>{const n=Ze();if(n._tag==="Left")return n;try{const s=`${e.baseUrl}/query?function=GLOBAL_QUOTE&symbol=${t}&apikey=${e.apiKey}`,o=await e.fetch(s,{signal:r});if(!o.ok)return o.status===429?A.Left({type:"rateLimit",retryAfter:60}):A.Left({type:"network",message:`HTTP ${o.status}: ${o.statusText}`});const c=await o.json();if(c["Error Message"])return A.Left({type:"invalidTicker",ticker:t});if(c.Note)return A.Left({type:"rateLimit",retryAfter:60});const a=c["Global Quote"];if(!a||!a["01. symbol"]||!a["05. price"])return A.Left({type:"parseError",raw:JSON.stringify(c)});const l={symbol:a["01. symbol"],price:parseFloat(a["05. price"]),timestamp:a["07. latest trading day"]};return A.Right(l)}catch(s){return s instanceof Error&&s.name==="AbortError"?A.Left({type:"network",message:"Request cancelled"}):A.Left({type:"unknown",error:s})}})),er=t=>{switch(t.type){case"network":return`Network error: ${t.message}`;case"rateLimit":return`Rate limit exceeded. Try again in ${t.retryAfter} seconds.`;case"invalidTicker":return`Invalid ticker: ${t.ticker}`;case"parseError":return"Failed to parse API response";case"unknown":return"Unknown error occurred"}},tt=t=>({apiKey:t,baseUrl:"https://www.alphavantage.co",fetch:window.fetch.bind(window)}),rr=(t,e,r)=>{switch(t.type){case"SET_TICKER":return{model:{...e,input:{...e.input,ticker:t.value.toUpperCase()},validationErrors:[]},effects:[]};case"SET_SHARES":return{model:{...e,input:{...e.input,shares:t.value},validationErrors:[]},effects:[]};case"ADD_HOLDING":{const n=Ke(e.input.ticker,e.input.shares);if(n._tag==="Failure"){const R=n.errors;return{model:{...e,validationErrors:R},effects:[]}}const{ticker:s,shares:o}=n.value,c=ze(s,e.holdings);if(c._tag==="Failure"){const R=c.errors;return{model:{...e,validationErrors:R},effects:[]}}const a=Xe(s).run(),l=v.getOrElse(0,a),h={ticker:s,shares:o,currentPrice:a,value:l>0?o*l:0},b=[...e.holdings,h],T=[Q(b)];if(v.isNothing(a)){const R=tt("YOUR_API_KEY_HERE");T.push(et(s,R,r))}return{model:{...e,holdings:b,input:{ticker:"",shares:""},validationErrors:[],fetchingPrices:v.isNothing(a)?new Set([...e.fetchingPrices,s]):e.fetchingPrices},effects:T}}case"REMOVE_HOLDING":{const n=e.holdings.filter(o=>o.ticker!==t.ticker),s=Q(n);return{model:{...e,holdings:n},effects:[s]}}case"FETCH_PRICE":{const n=tt("YOUR_API_KEY_HERE"),s=et(t.ticker,n,r);return{model:{...e,fetchingPrices:new Set([...e.fetchingPrices,t.ticker]),priceErrors:new Map([...e.priceErrors].filter(([o])=>o!==t.ticker))},effects:[s]}}case"PRICE_FETCHED":{const n=e.holdings.map(a=>a.ticker===t.ticker?{...a,currentPrice:v.Just(t.price),value:a.shares*t.price}:a),s=new Set(e.fetchingPrices);s.delete(t.ticker);const o=Q(n),c=Qe(t.ticker,t.price);return{model:{...e,holdings:n,fetchingPrices:s},effects:[o,c]}}case"PRICE_ERROR":{const n=new Set(e.fetchingPrices);n.delete(t.ticker);const s=new Map(e.priceErrors);return s.set(t.ticker,t.error),{model:{...e,fetchingPrices:n,priceErrors:s},effects:[]}}case"REFRESH_ALL_PRICES":{const n=tt("YOUR_API_KEY_HERE"),s=e.holdings.map(o=>et(o.ticker,n,r));return{model:{...e,fetchingPrices:new Set(e.holdings.map(o=>o.ticker)),priceErrors:new Map},effects:s}}case"CLEAR_VALIDATION_ERRORS":return{model:{...e,validationErrors:[]},effects:[]};default:return{model:e,effects:[]}}},et=(t,e,r)=>f(()=>{tr(t).run(e).run().then(s=>{if(s._tag==="Right"){const o=s.right;r({type:"PRICE_FETCHED",ticker:t,price:o.price})}else{const o=s.left;r({type:"PRICE_ERROR",ticker:t,error:er(o)})}})}),dt=t=>{const e=["BND","AGG","TLT","IEF","VGIT","BSV","MUB","LQD","HYG"],r=t.toUpperCase();return e.includes(r)?"bonds":"stocks"},Lt=t=>t.reduce((e,r)=>e+r.value,0),nr=g(t=>{const e=Lt(t);if(e===0)return[{stocks:0,bonds:0,cash:0},t];const r=t.filter(c=>dt(c.ticker)==="stocks").reduce((c,a)=>c+a.value,0),n=t.filter(c=>dt(c.ticker)==="bonds").reduce((c,a)=>c+a.value,0);return[{stocks:r/e*100,bonds:n/e*100,cash:0/e*100},t]}),rt=t=>g(e=>{const r=Lt(e),[n]=nr.run(e),s={stocks:n.stocks-t.stocks,bonds:n.bonds-t.bonds,cash:n.cash-t.cash};return[{current:n,target:t,drift:s,totalValue:r},e]}),I=t=>new Intl.NumberFormat("en-US",{style:"currency",currency:"USD",minimumFractionDigits:0,maximumFractionDigits:0}).format(t),O=t=>`${t.toFixed(1)}%`,sr=(t,e)=>{console.log("holdings",t);const r=[];return r.push(i("form",{onsubmit:n=>{n.preventDefault(),e({type:"ADD_HOLDING"})}},[i("div",{style:"display:grid;grid-template-columns:1fr 1fr auto;gap:0.5rem;"},[i("input",{type:"text",placeholder:"Ticker (e.g., AAPL)",value:t.input.ticker,oninput:n=>e({type:"SET_TICKER",value:n.target.value})}),i("input",{type:"number",placeholder:"Shares",value:t.input.shares,oninput:n=>e({type:"SET_SHARES",value:n.target.value})}),i("button",{type:"submit"},"Add")])])),t.validationErrors.length>0&&r.push(i("ul",{style:"color: var(--pico-del-color); margin-top: 0.5rem;"},t.validationErrors.map(n=>i("li",`${n.field}: ${n.message}`)))),t.holdings.length>0?r.push(i("figure",{style:"margin-top:1rem;"},[i("table",[i("thead",[i("tr",[i("th","Ticker"),i("th","Shares"),i("th","Price"),i("th","Value"),i("th","")])]),i("tbody",t.holdings.map(n=>i("tr",[i("td",n.ticker),i("td",n.shares.toString()),i("td",[v.isJust(n.currentPrice)?I(v.getOrElse(0,n.currentPrice)):t.fetchingPrices.has(n.ticker)?i("small","Loading..."):i("button",{onclick:()=>e({type:"FETCH_PRICE",ticker:n.ticker}),style:"padding:0.25rem 0.5rem;font-size:0.8rem;"},"Fetch")]),i("td",I(n.value)),i("td",[i("button",{onclick:()=>e({type:"REMOVE_HOLDING",ticker:n.ticker}),class:"secondary outline",style:"padding:0.25rem 0.5rem;font-size:0.8rem;"},"Remove")])])))])])):r.push(i("p",{style:"color: var(--pico-muted-color);"},"No holdings yet. Add your first position above.")),t.holdings.length>0&&r.push(i("button",{onclick:()=>e({type:"REFRESH_ALL_PRICES"}),class:"secondary",style:"margin-top:1rem;"},"Refresh All Prices")),i("div",r)},or=sr,ot={init:qe,update:rr,view:or},cr={stocks:60,bonds:30,cash:10},ir=f(()=>{const t=Ye().run();return{model:{target:v.getOrElse(cr,t),validationErrors:[]},effects:[]}}),ar=(t,e,r)=>{switch(t.type){case"SET_STOCKS":return{model:{...e,target:{...e.target,stocks:t.value},validationErrors:[]},effects:[]};case"SET_BONDS":return{model:{...e,target:{...e.target,bonds:t.value},validationErrors:[]},effects:[]};case"SET_CASH":return{model:{...e,target:{...e.target,cash:t.value},validationErrors:[]},effects:[]};case"APPLY":{const n=je(e.target.stocks,e.target.bonds,e.target.cash);if(n._tag==="Failure"){const c=n.errors;return{model:{...e,validationErrors:c},effects:[]}}const s=n.value,o=ft(s);return{model:{...e,target:s,validationErrors:[]},effects:[o]}}case"RESET_DEFAULT":{const n={stocks:60,bonds:30,cash:10},s=ft(n);return{model:{...e,target:n,validationErrors:[]},effects:[s]}}case"CLEAR_VALIDATION_ERRORS":return{model:{...e,validationErrors:[]},effects:[]};default:return{model:e,effects:[]}}},lr=(t,e)=>{const{stocks:r,bonds:n,cash:s}=t.target,o=r+n+s,c=t.validationErrors.length>0?[i("ul",{style:"color: var(--pico-del-color); margin-top: 0.5rem;"},t.validationErrors.map(a=>i("li",`${a.field}: ${a.message}`)))]:[];return[i("div",[i("div",{class:"grid",style:"grid-template-columns: 1fr 3fr;"},[i("label",{for:"stocks-slider"},"Stocks"),i("input",{id:"stocks-slider",type:"range",min:0,max:100,value:r,oninput:a=>e({type:"SET_STOCKS",value:Number(a.target.value)})})]),i("small",`Stocks: ${O(r)}`),i("div",{class:"grid",style:"grid-template-columns: 1fr 3fr;"},[i("label",{for:"bonds-slider"},"Bonds"),i("input",{id:"bonds-slider",type:"range",min:0,max:100,value:n,oninput:a=>e({type:"SET_BONDS",value:Number(a.target.value)})})]),i("small",`Bonds: ${O(n)}`),i("div",{class:"grid",style:"grid-template-columns: 1fr 3fr;"},[i("label",{for:"cash-slider"},"Cash"),i("input",{id:"cash-slider",type:"range",min:0,max:100,value:s,oninput:a=>e({type:"SET_CASH",value:Number(a.target.value)})})]),i("small",`Cash: ${O(s)}`),i("p",{style:"margin-top: 0.5rem;"},[i("strong","Total: "),`${o}%`]),i("div",{class:"grid",style:"margin-top: 0.75rem;"},[i("button",{onclick:()=>e({type:"APPLY"})},"Apply target"),i("button",{class:"secondary outline",onclick:()=>e({type:"RESET_DEFAULT"})},"Reset to 60/30/10")]),...c])]},ur=lr,ct={init:ir,update:ar,view:ur},fr=f(()=>({model:{report:null},effects:[]})),dr=(t,e,r)=>{switch(t.type){case"SET_REPORT":return{model:{...e,report:t.report},effects:[]};case"CLEAR":return{model:{...e,report:null},effects:[]};default:return{model:e,effects:[]}}},gr=t=>{const e=Math.abs(t);return e<1?"drift-green":e<=5?"drift-yellow":"drift-red"},pr=(t,e)=>{const r=t.report;if(console.log("drift",t),!r)return i("p",{style:"color: var(--pico-muted-color);"},"No drift data yet. Add holdings and save a target allocation.");const n=[["Stocks",r.current.stocks,r.target.stocks,r.drift.stocks],["Bonds",r.current.bonds,r.target.bonds,r.drift.bonds],["Cash",r.current.cash,r.target.cash,r.drift.cash]];return i("div",[i("p",{style:"font-size: 0.9rem; color: var(--pico-muted-color);"},`Total portfolio value ${I(r.totalValue)}`),i("figure",[i("table",[i("thead",[i("tr",[i("th","Asset class"),i("th","Current"),i("th","Target"),i("th","Drift")])]),i("tbody",n.map(([s,o,c,a])=>i("tr",[i("td",String(s)),i("td",O(o)),i("td",O(c)),i("td",{class:gr(a)},O(a))])))])])])},hr=pr,it={init:fr,update:dr,view:hr},mr=f(()=>({model:{plan:null},effects:[]})),yr=(t,e,r)=>{switch(t.type){case"SET_PLAN":return{model:{...e,plan:t.plan},effects:[]};case"CLEAR":return{model:{...e,plan:null},effects:[]};default:return{model:e,effects:[]}}},Er=(t,e)=>{console.log("trades",t);const r=t.plan;return r?i("div",[i("p",{style:"font-size: 0.9rem; color: var(--pico-muted-color);"},["Final allocation: ",`Stocks ${O(r.finalAllocation.stocks)}, `,`Bonds ${O(r.finalAllocation.bonds)}, `,`Cash ${O(r.finalAllocation.cash)}.`," ",r.cashNeeded>0?`Add ${I(r.cashNeeded)} of new cash.`:r.cashNeeded<0?`You will receive ${I(Math.abs(r.cashNeeded))} of cash.`:"No net cash movement required."]),r.trades.length>0?i("figure",[i("table",[i("thead",[i("tr",[i("th","Action"),i("th","Ticker"),i("th","Shares"),i("th","Price"),i("th","Total")])]),i("tbody",r.trades.map((n,s)=>i("tr",{key:s},[i("td",n.action.toUpperCase()),i("td",n.ticker),i("td",n.shares.toString()),i("td",I(n.price)),i("td",I(n.total))])))])]):i("p",{style:"color: var(--pico-muted-color);"},"No trades required. Allocation is within tolerance.")]):i("p",{style:"color: var(--pico-muted-color);"},"No trade plan generated yet.")},wr=Er,at={init:mr,update:yr,view:wr},vr=f(()=>({model:{entries:[]},effects:[]})),Sr=(t,e,r)=>{switch(t.type){case"ADD_ENTRY":return{model:{...e,entries:[t.entry,...e.entries]},effects:[]};case"CLEAR":return{model:{...e,entries:[]},effects:[]};case"EXPORT_JSON":{const n=JSON.stringify(e.entries,null,2),s=f(()=>{const o=new Blob([n],{type:"application/json"}),c=URL.createObjectURL(o),a=document.createElement("a");a.href=c,a.download=`fp-rebalance-audit-${Date.now()}.json`,document.body.appendChild(a),a.click(),a.remove(),URL.revokeObjectURL(c)});return{model:e,effects:[s]}}default:return{model:e,effects:[]}}},br=(t,e)=>(console.log("audit",t),i("div",[i("div",{style:"display:flex; gap:0.5rem; margin-bottom:0.5rem;"},[i("button",{type:"button",class:"secondary",onclick:()=>e({type:"EXPORT_JSON"})},"Export JSON"),t.entries.length>0?i("button",{type:"button",class:"secondary outline",onclick:()=>e({type:"CLEAR"})},"Clear"):null]),t.entries.length===0?i("p",{style:"color: var(--pico-muted-color);"},"No audit entries yet."):i("div",{style:"max-height: 260px; overflow-y: auto; font-size: 0.8rem; border: 1px solid var(--pico-muted-border-color); border-radius: 0.5rem; padding: 0.5rem;"},t.entries.map((r,n)=>i("details",{key:n},[i("summary",`[${r.timestamp}] ${r.operation} (${r.success?"ok":"error"})`),i("pre",{style:"white-space: pre-wrap; word-break: break-word; margin-top:0.25rem;"},JSON.stringify(r.details,null,2))])))])),_r=br,lt={init:vr,update:Sr,view:_r},Rr=f(()=>{const t=ot.init.run(),e=ct.init.run(),r=it.init.run(),n=at.init.run(),s=lt.init.run(),o={holdings:t.model,targets:e.model,drift:r.model,trades:n.model,audit:s.model},c=[...t.effects,...e.effects,...r.effects,...n.effects,...s.effects];return{model:o,effects:c}}),J=(t,e,r)=>(n,s,o)=>{const{model:c,effects:a}=t(n.msg,s[e],h=>o(r(h)));return{model:{...s,[e]:c},effects:a}},kr=(t,e,r)=>{switch(t.type){case"Holdings":{const n=J(ot.update,"holdings",c=>({type:"Holdings",msg:c}))(t,e,r),s=t.msg;if(s.type==="PRICE_FETCHED"||s.type==="ADD_HOLDING"||s.type==="REMOVE_HOLDING"){const c=f(()=>{const a=n.model.holdings.holdings,l=n.model.targets.target,[h]=rt(l).run(a);r({type:"Drift",msg:{type:"SET_REPORT",report:h}})});return{model:n.model,effects:[...n.effects,c]}}return n}case"Targets":{const n=J(ct.update,"targets",c=>({type:"Targets",msg:c}))(t,e,r),s=t.msg;if(s.type==="APPLY"||s.type==="RESET_DEFAULT"){const c=f(()=>{const a=n.model.holdings.holdings,l=n.model.targets.target,[h]=rt(l).run(a);r({type:"Drift",msg:{type:"SET_REPORT",report:h}})});return{model:n.model,effects:[...n.effects,c]}}return n}case"Drift":return J(it.update,"drift",n=>({type:"Drift",msg:n}))(t,e,r);case"Trades":return J(at.update,"trades",n=>({type:"Trades",msg:n}))(t,e,r);case"Audit":return J(lt.update,"audit",n=>({type:"Audit",msg:n}))(t,e,r);case"RECALCULATE_ALL":{const n=f(()=>{const s=e.holdings.holdings,o=e.targets.target,[c]=rt(o).run(s);r({type:"Drift",msg:{type:"SET_REPORT",report:c}})});return{model:e,effects:[n]}}default:return{model:e,effects:[]}}},Ar=(t,e)=>{const r=ot.view(t.holdings,a=>e({type:"Holdings",msg:a})),n=ct.view(t.targets,a=>e({type:"Targets",msg:a})),s=it.view(t.drift,a=>e({type:"Drift",msg:a})),o=at.view(t.trades,a=>e({type:"Trades",msg:a})),c=lt.view(t.audit,a=>e({type:"Audit",msg:a}));return[i("header",[i("h1","FPRebalance"),i("p","Mathematically Correct Portfolio Management")]),i("section",r),i("section",n),i("section",s),i("section",o),i("section",c)]},Tr=(t,e)=>Ar(t,e),Lr={init:Rr,update:kr,view:Tr},Nr=f(()=>{const t=document.getElementById("app");if(!t)throw new Error("#app not found");return t});Ve(Ue,At())(Nr,Lr).run();
